import{g as te,a3 as re,aZ as se,W as c,X as ie,c as ne,w as l,b1 as ue,o as de,a as e,b as M,cn as E,u as n,d as L,f as u,an as y,e as i,t as d,V as me,ba as G,aR as D,aS as S,b2 as W,ac as X,b3 as P,bv as T,ae as U,bu as q,bo as ve}from"./index-CRgOuqdl.js";import{u as fe}from"./permissions_store-tFhag5MC.js";import{_ as pe}from"./BaseBreadcrumb.vue_vue_type_style_index_0_lang-oQzYD9gG.js";import{_ as Z}from"./UiParentCard.vue_vue_type_script_setup_true_lang-1FnjXCzn.js";const ce={class:"d-flex gap-2"},ge={class:"d-flex gap-2"},we=te({__name:"roles",setup(_e){const{t:r}=re(),s=fe(),$=se(),V=c(!1),b=c(!1),C=c(!1),k=c(!1),R=c(!1),x=c(!1),g=c(!1),_=c(!1),F=c(!1),w=c([]),j=c({title:r("admin.roles.title")}),H=c([{title:r("admin.title "),disabled:!1,href:"/"},{title:r("admin.roles.title"),disabled:!0,href:"#"}]),I=[{title:r("admin.roles.table.name"),key:"name",sortable:!0,width:"25%"},{title:r("admin.roles.table.description"),key:"description",sortable:!0,width:"25%"},{title:r("admin.roles.table.permissions"),key:"permissionsCount",sortable:!0,width:"25%"},{title:r("admin.roles.table.created_at"),key:"createdAt",sortable:!0,width:"25%"},{title:r("admin.roles.table.actions"),key:"actions",sortable:!1,width:"25%"}],v=c({name:"",description:"",id:""}),f=c({name:"",description:"",id:""});ie(async()=>{await s.fetchGroups(),await s.fetchRoles(),await s.fetchPermissions()});const J=()=>{R.value=!1,v.value={name:"",description:""},V.value=!0},K=t=>{R.value=!0,v.value={...t},V.value=!0},z=async()=>{_.value=!0;try{R.value?await s.updateGroup(v.value.id,v.value):await s.createGroup(v.value),await s.fetchGroups(),V.value=!1}catch(t){$.error({message:r("errors.save_error",{error:t||"Save error"})})}finally{_.value=!1}},O=()=>{x.value=!1,f.value={name:"",description:""},b.value=!0},Q=t=>{x.value=!0,f.value={...t},b.value=!0},A=async()=>{_.value=!0;try{x.value?await s.updateRole(f.value.id,f.value):await s.createRole(f.value),await s.fetchRoles(),b.value=!1}catch(t){$.error({message:r("errors.save_error",{error:t||"Save error"})})}finally{_.value=!1}},Y=async t=>{var o;g.value=!1,v.value={...t},w.value=((o=t.permissions)==null?void 0:o.map(a=>a.permission.id))||[],C.value=!0},h=async t=>{var o;g.value=!0,f.value={...t},w.value=((o=t.rolePermissions)==null?void 0:o.map(a=>a.permission.id))||[],C.value=!0},ee=async()=>{var t,o;_.value=!0;try{const a=g.value?f.value.id:v.value.id,p=g.value?((t=f.value.rolePermissions)==null?void 0:t.map(m=>m.permission.id))||[]:((o=v.value.permissions)==null?void 0:o.map(m=>m.permission.id))||[],B=w.value.filter(m=>!p.includes(m)),N=p.filter(m=>!w.value.includes(m));if(g.value){for(const m of B)await s.assignToRole(a,m);for(const m of N)await s.removeFromRole(a,m)}else{for(const m of B)await s.assignToGroup(a,m);for(const m of N)await s.removeFromGroup(a,m)}await s.fetchGroups(),await s.fetchRoles(),C.value=!1}catch(a){$.error({message:r("errors.save_error",{error:a||"Save error"})})}finally{_.value=!1}},le=t=>{g.value=!1,v.value={...t},k.value=!0},ae=t=>{g.value=!0,f.value={...t},k.value=!0},oe=async()=>{F.value=!0;try{g.value?(await s.deleteRole(f.value.id),await s.fetchRoles()):(await s.deleteGroup(v.value.id),await s.fetchGroups()),k.value=!1}catch(t){$.error({message:r("errors.delete_error",{error:t||"Delete error"})})}finally{F.value=!1}};return(t,o)=>(de(),ne(ue,null,{default:l(()=>[e(pe,{title:j.value.title,breadcrumbs:H.value},null,8,["title","breadcrumbs"]),e(me,null,{default:l(()=>[e(M,{cols:"12"},{default:l(()=>[e(Z,{title:"Roles"},{action:l(()=>[e(u,{color:"primary","prepend-icon":"mdi-plus",onClick:O},{default:l(()=>[i(d(t.$t("admin.roles.add_role")),1)]),_:1})]),default:l(()=>[e(E,{headers:I,items:n(s).roles,loading:n(s).isLoading},{"item.permissionsCount":l(({item:a})=>{var p;return[i(d(((p=a.rolePermissions)==null?void 0:p.length)||0),1)]}),"item.actions":l(({item:a})=>[L("div",ce,[e(u,{icon:"",variant:"text",color:"secondary",size:"small",onClick:p=>Q(a)},{default:l(()=>[e(y,null,{default:l(()=>o[13]||(o[13]=[i("mdi-pencil")])),_:1,__:[13]})]),_:2},1032,["onClick"]),e(u,{icon:"",variant:"text",color:"info",size:"small",onClick:p=>h(a)},{default:l(()=>[e(y,null,{default:l(()=>o[14]||(o[14]=[i("mdi-shield-account")])),_:1,__:[14]})]),_:2},1032,["onClick"]),e(u,{icon:"",variant:"text",color:"error",size:"small",onClick:p=>ae(a)},{default:l(()=>[e(y,null,{default:l(()=>o[15]||(o[15]=[i("mdi-delete")])),_:1,__:[15]})]),_:2},1032,["onClick"])])]),_:1},8,["items","loading"])]),_:1})]),_:1}),e(M,{cols:"12"},{default:l(()=>[e(Z,{title:"Groups"},{action:l(()=>[e(u,{color:"primary","prepend-icon":"mdi-plus",onClick:J},{default:l(()=>o[16]||(o[16]=[i(" Add Group ")])),_:1,__:[16]})]),default:l(()=>[e(E,{headers:I,items:n(s).groups,loading:n(s).isLoading},{"item.permissionsCount":l(({item:a})=>{var p;return[i(d(((p=a.permissions)==null?void 0:p.length)||0),1)]}),"item.actions":l(({item:a})=>[L("div",ge,[e(u,{icon:"",variant:"text",color:"secondary",size:"small",onClick:p=>K(a)},{default:l(()=>[e(y,null,{default:l(()=>o[17]||(o[17]=[i("mdi-pencil")])),_:1,__:[17]})]),_:2},1032,["onClick"]),e(u,{icon:"",variant:"text",color:"info",size:"small",onClick:p=>Y(a)},{default:l(()=>[e(y,null,{default:l(()=>o[18]||(o[18]=[i("mdi-shield-account")])),_:1,__:[18]})]),_:2},1032,["onClick"]),e(u,{icon:"",variant:"text",color:"error",size:"small",onClick:p=>le(a)},{default:l(()=>[e(y,null,{default:l(()=>o[19]||(o[19]=[i("mdi-delete")])),_:1,__:[19]})]),_:2},1032,["onClick"])])]),_:1},8,["items","loading"])]),_:1})]),_:1})]),_:1}),e(q,{modelValue:V.value,"onUpdate:modelValue":o[3]||(o[3]=a=>V.value=a),"max-width":"500px"},{default:l(()=>[e(G,null,{default:l(()=>[e(D,{class:"text-h5 pa-4"},{default:l(()=>[i(d(R.value?n(r)("admin.roles.edit_group"):n(r)("admin.roles.create_group")),1)]),_:1}),e(S,{class:"pa-4"},{default:l(()=>[e(W,{ref:"groupForm",onSubmit:X(z,["prevent"])},{default:l(()=>[e(P,{rounded:"none",modelValue:v.value.name,"onUpdate:modelValue":o[0]||(o[0]=a=>v.value.name=a),label:n(r)("admin.roles.table.name"),required:"",rules:[a=>!!a||n(r)("errors.required")]},null,8,["modelValue","label","rules"]),e(P,{rounded:"none",modelValue:v.value.description,"onUpdate:modelValue":o[1]||(o[1]=a=>v.value.description=a),label:n(r)("admin.roles.table.description"),required:"",rules:[a=>!!a||n(r)("errors.required")]},null,8,["modelValue","label","rules"])]),_:1},512)]),_:1}),e(T,{class:"pa-4"},{default:l(()=>[e(U),e(u,{color:"grey-darken-1",variant:"text",onClick:o[2]||(o[2]=a=>V.value=!1)},{default:l(()=>[i(d(t.$t("general.actions.cancel")),1)]),_:1}),e(u,{color:"primary",onClick:z,loading:_.value},{default:l(()=>[i(d(t.$t("general.actions.save")),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(q,{modelValue:b.value,"onUpdate:modelValue":o[7]||(o[7]=a=>b.value=a),"max-width":"500px"},{default:l(()=>[e(G,null,{default:l(()=>[e(D,{class:"text-h5 pa-4"},{default:l(()=>[i(d(x.value?n(r)("admin.roles.edit_role"):n(r)("admin.roles.create_role")),1)]),_:1}),e(S,{class:"pa-4"},{default:l(()=>[e(W,{ref:"roleForm",onSubmit:X(A,["prevent"])},{default:l(()=>[e(P,{rounded:"none",modelValue:f.value.name,"onUpdate:modelValue":o[4]||(o[4]=a=>f.value.name=a),label:n(r)("admin.roles.table.name"),required:"",rules:[a=>!!a||n(r)("errors.required")]},null,8,["modelValue","label","rules"]),e(P,{rounded:"none",modelValue:f.value.description,"onUpdate:modelValue":o[5]||(o[5]=a=>f.value.description=a),label:n(r)("admin.roles.table.description"),required:"",rules:[a=>!!a||n(r)("errors.required")]},null,8,["modelValue","label","rules"])]),_:1},512)]),_:1}),e(T,{class:"pa-4"},{default:l(()=>[e(U),e(u,{color:"grey-darken-1",variant:"text",onClick:o[6]||(o[6]=a=>b.value=!1)},{default:l(()=>[i(d(t.$t("general.actions.cancel")),1)]),_:1}),e(u,{color:"primary",onClick:A,loading:_.value},{default:l(()=>[i(d(t.$t("general.actions.save")),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(q,{modelValue:C.value,"onUpdate:modelValue":o[10]||(o[10]=a=>C.value=a),"max-width":"600px"},{default:l(()=>[e(G,null,{default:l(()=>[e(D,{class:"text-h5 pa-4"},{default:l(()=>[i(d(g.value?n(r)("admin.roles.manage_role"):n(r)("admin.roles.manage_group")),1)]),_:1}),e(S,{class:"pa-4"},{default:l(()=>[e(ve,{rounded:"none",modelValue:w.value,"onUpdate:modelValue":o[8]||(o[8]=a=>w.value=a),items:n(s).permissions,"item-title":"name","item-value":"id",multiple:"",chips:"",label:n(r)("admin.roles.permissions")},null,8,["modelValue","items","label"])]),_:1}),e(T,{class:"pa-4"},{default:l(()=>[e(U),e(u,{color:"grey-darken-1",variant:"text",onClick:o[9]||(o[9]=a=>C.value=!1)},{default:l(()=>[i(d(t.$t("general.actions.cancel")),1)]),_:1}),e(u,{color:"primary",onClick:ee,loading:_.value},{default:l(()=>[i(d(t.$t("general.actions.save")),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(q,{modelValue:k.value,"onUpdate:modelValue":o[12]||(o[12]=a=>k.value=a),"max-width":"400px"},{default:l(()=>[e(G,null,{default:l(()=>[e(D,{class:"text-h5 pa-4"},{default:l(()=>[i(d(t.$t(`admin.roles.delete_${g.value?"role":"group"}`)),1)]),_:1}),e(S,{class:"pa-4"},{default:l(()=>[i(d(t.$t(`admin.roles.delete_confirmation_${g.value?"role":"group"}`)),1)]),_:1}),e(T,{class:"pa-4"},{default:l(()=>[e(U),e(u,{color:"grey-darken-1",variant:"text",onClick:o[11]||(o[11]=a=>k.value=!1)},{default:l(()=>[i(d(t.$t("general.actions.cancel")),1)]),_:1}),e(u,{color:"error",onClick:oe,loading:F.value},{default:l(()=>[i(d(t.$t("general.actions.delete")),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}});export{we as default};
