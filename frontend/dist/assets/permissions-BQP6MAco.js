import{g as O,a3 as B,aZ as x,W as o,X as G,c as j,w as i,b1 as z,o as J,a as s,b as W,cn as X,u as E,d as Y,f as d,an as T,e as t,t as m,V as Z,ba as g,aR as C,aS as k,b2 as K,ac as Q,b3 as $,bo as D,bv as w,ae as A,bu as P}from"./index-5wn-0GR-.js";import{u as ee}from"./permissions_store-CsOR62Oh.js";import{_ as se}from"./BaseBreadcrumb.vue_vue_type_style_index_0_lang-BOmi3NWL.js";import{_ as ae}from"./UiParentCard.vue_vue_type_script_setup_true_lang-DQjgUtM8.js";const ie={class:"d-flex gap-2"},ue=O({__name:"permissions",setup(re){const{t:e}=B(),_=x(),u=ee(),p=o(!1),c=o(!1),v=o(!1),f=o(!1),y=o(!1),S=o(null),R=o({title:e("admin.permissions.title")}),I=o([{title:e("admin.title"),disabled:!1,href:"/"},{title:e("admin.permissions.title"),disabled:!0,href:"#"}]),N=[{title:e("admin.permissions.table.name"),key:"name",sortable:!0},{title:e("admin.permissions.table.description"),key:"description",sortable:!0},{title:e("admin.permissions.table.permission_action"),key:"action",value:a=>a.action.charAt(0)+a.action.slice(1).toLowerCase(),sortable:!0},{title:e("admin.permissions.table.resource_type"),key:"resourceType",value:a=>a.resourceType.charAt(0)+a.resourceType.slice(1).toLowerCase(),sortable:!0},{title:e("admin.permissions.table.created_at"),key:"createdAt",sortable:!0},{title:e("admin.permissions.table.actions"),key:"actions",sortable:!1,align:"end"}],U=o([{name:e("admin.permissions.permission_types.read"),value:"READ"},{name:e("admin.permissions.permission_types.create"),value:"CREATE"},{name:e("admin.permissions.permission_types.update"),value:"UPDATE"},{name:e("admin.permissions.permission_types.delete"),value:"DELETE"},{name:e("admin.permissions.permission_types.manage"),value:"MANAGE"}]),q=o([{name:e("admin.permissions.resource_types.all"),value:"ALL"},{name:e("admin.permissions.resource_types.finance"),value:"FINANCE"},{name:e("admin.permissions.resource_types.melding"),value:"MELDING"},{name:e("admin.permissions.resource_types.idee"),value:"IDEE"},{name:e("admin.permissions.resource_types.project"),value:"PROJECT"},{name:e("admin.permissions.resource_types.schade"),value:"SCHADE"},{name:e("admin.permissions.resource_types.projectleider"),value:"PROJECTLEIDER"},{name:e("admin.permissions.resource_types.status"),value:"STATUS"},{name:e("admin.permissions.resource_types.user"),value:"USER"},{name:e("admin.permissions.resource_types.correctief"),value:"CORRECTIEF"},{name:e("admin.permissions.resource_types.actiehouders"),value:"ACTIEHOUDER"},{name:e("admin.permissions.resource_types.preventief"),value:"PREVENTIEF"},{name:e("admin.permissions.resource_types.chat"),value:"CHAT"},{name:e("admin.permissions.resource_types.archive"),value:"ARCHIVE"},{name:e("admin.permissions.resource_types.history"),value:"HISTORY"},{name:e("admin.permissions.resource_types.audit"),value:"AUDIT"},{name:e("admin.permissions.resource_types.settings"),value:"SETTINGS"},{name:e("admin.permissions.resource_types.department"),value:"DEPARTMENT"}]),n=o({name:"",description:"",action:"",resourceType:""});G(async()=>{await u.fetchPermissions()});const h=()=>{v.value=!1,n.value={name:"",description:"",action:"",resourceType:""},p.value=!0},L=a=>{v.value=!0,n.value={...a},p.value=!0},b=()=>{p.value=!1,n.value={name:"",description:"",action:"",resourceType:""}},V=async()=>{f.value=!0;try{if(!n.value.name||!n.value.description)throw new Error(e("admin.permissions.rules.name_required"));if(!n.value.action||!n.value.resourceType)throw new Error(e("admin.permissions.rules.resource_type_required"));v.value?await u.updatePermission(n.value.id,n.value):await u.createPermission(n.value),await u.fetchPermissions(),b()}catch(a){_.error({message:e("errors.save_error",{error:a||"Save error"})})}finally{f.value=!1}},F=a=>{n.value={...a},c.value=!0},H=async()=>{y.value=!0;try{await u.deletePermission(n.value.id),await u.fetchPermissions(),c.value=!1}catch(a){_.error({message:e("errors.delete_error",{error:a||"Delete error"})})}finally{y.value=!1}};return(a,l)=>(J(),j(z,null,{default:i(()=>[s(se,{title:R.value.title,breadcrumbs:I.value},null,8,["title","breadcrumbs"]),s(Z,null,{default:i(()=>[s(W,{cols:"12"},{default:i(()=>[s(ae,{title:"Permissions"},{action:i(()=>[s(d,{color:"primary","prepend-icon":"mdi-plus",onClick:h},{default:i(()=>[t(m(a.$t("admin.permissions.add_permission")),1)]),_:1})]),default:i(()=>[s(X,{headers:N,items:E(u).permissions,loading:E(u).isLoading,hover:""},{"item.actions":i(({item:r})=>[Y("div",ie,[s(d,{icon:"",variant:"text",color:"secondary",size:"small",onClick:M=>L(r)},{default:i(()=>[s(T,null,{default:i(()=>l[7]||(l[7]=[t("mdi-pencil")])),_:1,__:[7]})]),_:2},1032,["onClick"]),s(d,{icon:"",variant:"text",color:"error",size:"small",onClick:M=>F(r)},{default:i(()=>[s(T,null,{default:i(()=>l[8]||(l[8]=[t("mdi-delete")])),_:1,__:[8]})]),_:2},1032,["onClick"])])]),_:1},8,["items","loading"])]),_:1})]),_:1})]),_:1}),s(P,{modelValue:p.value,"onUpdate:modelValue":l[4]||(l[4]=r=>p.value=r),"max-width":"500px"},{default:i(()=>[s(g,null,{default:i(()=>[s(C,{class:"text-h5 pa-4"},{default:i(()=>[t(m(v.value?"Edit Permission":"Create Permission"),1)]),_:1}),s(k,{class:"pa-4"},{default:i(()=>[s(K,{ref_key:"form",ref:S,onSubmit:Q(V,["prevent"])},{default:i(()=>[s($,{rounded:"none",modelValue:n.value.name,"onUpdate:modelValue":l[0]||(l[0]=r=>n.value.name=r),label:a.$t("admin.permissions.table.name"),required:"",rules:[r=>!!r||a.$t("admin.permissions.rules.name_required")]},null,8,["modelValue","label","rules"]),s($,{rounded:"none",modelValue:n.value.description,"onUpdate:modelValue":l[1]||(l[1]=r=>n.value.description=r),label:a.$t("admin.permissions.table.description"),required:"",rules:[r=>!!r||a.$t("admin.permissions.rules.description_required")]},null,8,["modelValue","label","rules"]),s(D,{rounded:"none",modelValue:n.value.action,"onUpdate:modelValue":l[2]||(l[2]=r=>n.value.action=r),items:U.value,"item-title":"name","item-value":"value",label:a.$t("admin.permissions.table.permission_action"),required:"",rules:[r=>!!r||a.$t("admin.permissions.rules.permission_action_required")]},null,8,["modelValue","items","label","rules"]),s(D,{rounded:"none",modelValue:n.value.resourceType,"onUpdate:modelValue":l[3]||(l[3]=r=>n.value.resourceType=r),items:q.value,"item-title":"name","item-value":"value",label:a.$t("admin.permissions.table.resource_type"),required:"",rules:[r=>!!r||a.$t("admin.permissions.rules.resource_type_required")]},null,8,["modelValue","items","label","rules"])]),_:1},512)]),_:1}),s(w,{class:"pa-4"},{default:i(()=>[s(A),s(d,{color:"grey-darken-1",variant:"text",onClick:b},{default:i(()=>[t(m(a.$t("general.actions.cancel")),1)]),_:1}),s(d,{color:"primary",onClick:V,loading:f.value},{default:i(()=>[t(m(a.$t("general.actions.save")),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(P,{modelValue:c.value,"onUpdate:modelValue":l[6]||(l[6]=r=>c.value=r),"max-width":"400px"},{default:i(()=>[s(g,null,{default:i(()=>[s(C,{class:"text-h5 pa-4"},{default:i(()=>[t(m(a.$t("admin.permissions.delete_confirmation")),1)]),_:1}),s(k,{class:"pa-4"},{default:i(()=>[t(m(a.$t("admin.permissions.delete_confirmation_text")),1)]),_:1}),s(w,{class:"pa-4"},{default:i(()=>[s(A),s(d,{color:"grey-darken-1",variant:"text",onClick:l[5]||(l[5]=r=>c.value=!1)},{default:i(()=>[t(m(a.$t("general.actions.cancel")),1)]),_:1}),s(d,{color:"error",onClick:H,loading:y.value},{default:i(()=>[t(m(a.$t("general.actions.delete")),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}});export{ue as default};
