import{g as ie,a3 as se,W as d,X as de,c as w,w as a,b1 as K,o as p,a as t,aR as I,V as G,b as c,d as f,b3 as D,f as u,e as n,cn as ue,u as L,bn as W,co as ce,N as y,P as Z,J as H,t as b,O as J,ba as S,aS as T,bG as me,E as ve,cp as pe,cq as fe,bv as q,ae as _,bu as O,b5 as je,bi as ge,_ as De}from"./index-CRgOuqdl.js";import{u as be}from"./project_store-k4V-_sAl.js";import{u as Pe}from"./projectleider_store-Bm8tGFB1.js";import{u as Ve}from"./pageStore-Cstu7wip.js";import{L as N,m as ke,a as ye,b as _e,i as xe,v as Ce}from"./marker-shadow-CFIQJAzg.js";const we={key:0},Ie={key:1},Le={class:"d-flex align-center deelorders-container"},Se={class:"text-h5"},Ne={class:"deelorders-section rounded-lg"},Ue={class:"d-flex align-center mb-4"},Ee={key:0,class:"text-subtitle-2 text-grey mt-2"},ze={style:{height:"500px",width:"100%"}},Ae=ie({__name:"ProjectAdministration",setup(Be){const g=be(),U=Pe(),X=Ve(),{t:Te}=se(),m=d(!1),E=d(""),P=d(!1),x=d(!1),V=d(!1),z=d(null),s=d(null),A=d([52.1326,5.2913]),B=d(7),o=d({id:"",ProjectNaam:"",NumberID:"",ProjectLeider:null,ProjectleiderId:void 0,StartDate:"",EndDate:"",ProjectLocatie:"",Beschrijving:"",Deelorders:[],CreatedAt:"",UpdatedAt:""}),C={id:"",ProjectNaam:"",NumberID:"",ProjectLeider:null,ProjectleiderId:void 0,StartDate:"",EndDate:"",ProjectLocatie:"",Beschrijving:"",Deelorders:[],CreatedAt:"",UpdatedAt:""},v=d(""),$=()=>{const r=v.value.trim();r&&!o.value.Deelorders.includes(r)?(o.value.Deelorders.push(r),v.value=""):r&&(v.value="")},Y=r=>{o.value.Deelorders.splice(r,1)},Q=[{title:"Projectnaam",key:"ProjectNaam",align:"start",sortable:!0},{title:"Projectnummer",key:"NumberID",align:"start",sortable:!0},{title:"Projectteam",key:"ProjectLeider",align:"start",sortable:!1},{title:"Startdatum",key:"StartDate",align:"start",sortable:!0},{title:"Einddatum",key:"EndDate",align:"start",sortable:!0},{title:"Locatie",key:"ProjectLocatie",align:"start",sortable:!1},{title:"Deelorders",key:"Deelorders",align:"start",sortable:!1},{title:"Acties",key:"actions",sortable:!1,align:"end"}],k={required:r=>!!r||"Dit veld is verplicht",numberID:r=>/^\d+$/.test(r)||"Alleen nummers zijn toegestaan"},ee=r=>{o.value={...C,...r,ProjectLocatie:r.ProjectLocatie||""},P.value=!0},te=r=>{o.value={...C,...r,ProjectLocatie:r.ProjectLocatie||""},x.value=!0},le=async()=>{try{m.value=!0,await g.deleteProject(o.value.id),await g.fetchProjects(),M()}catch(r){console.error("Error deleting project:",r)}finally{m.value=!1}},h=()=>{P.value=!1,o.value=Object.assign({},C)},M=()=>{x.value=!1,o.value=Object.assign({},C)},ae=async()=>{try{m.value=!0;const r={ProjectNaam:o.value.ProjectNaam,NumberID:parseInt(o.value.NumberID),ProjectleiderId:o.value.ProjectleiderId,StartDate:o.value.StartDate?new Date(o.value.StartDate):null,EndDate:o.value.EndDate?new Date(o.value.EndDate):null,ProjectLocatie:o.value.ProjectLocatie||"",Beschrijving:o.value.Beschrijving||"",Deelorders:o.value.Deelorders||[]};o.value.id?await g.updateProject(o.value.id,r):await g.createProject(r),h()}catch(r){console.error("Error saving project:",r)}finally{m.value=!1}};delete N.Icon.Default.prototype._getIconUrl,N.Icon.Default.mergeOptions({iconRetinaUrl:_e,iconUrl:ye,shadowUrl:ke});const oe=r=>{var i;const{lat:e,lng:j}=r.latlng,l=(i=z.value)==null?void 0:i.leafletObject;l&&(s.value&&(s.value.remove(),s.value=null),s.value=N.marker([e,j]).addTo(l),o.value.ProjectLocatie=`${j.toFixed(6)},${e.toFixed(6)}`)},re=()=>{V.value=!1},ne=async()=>{var j;V.value=!0,await je();const r=(j=z.value)==null?void 0:j.leafletObject;if(!r)return;const e=o.value.ProjectLocatie;if(e&&e!==""){const[l,i]=e.split(",").map(R=>parseFloat(R.trim()));!isNaN(i)&&!isNaN(l)&&(A.value=[i,l],B.value=15,s.value&&(s.value.remove(),s.value=null),s.value=N.marker([i,l]).addTo(r))}},F=()=>{s.value&&(s.value.remove(),s.value=null),V.value=!1};return de(async()=>{m.value=!0;try{g.projects.length===0&&await g.fetchProjects(),U.projectleiders.length===0&&await U.fetchProjectleiders(),X.setPageInfo("Projecten",[{title:"Home",href:"/"},{title:"Projecten",href:"/overzicht"}])}catch(r){console.error("Error fetching data:",r)}finally{m.value=!1}}),(r,e)=>{const j=ge("permission");return p(),w(K,{fluid:""},{default:a(()=>[t(S,null,{default:a(()=>[t(I,null,{default:a(()=>[t(G,{align:"center"},{default:a(()=>[t(c,{cols:"6"},{default:a(()=>e[14]||(e[14]=[f("span",{class:"text-h5"},null,-1)])),_:1,__:[14]}),t(c,{cols:"4"},{default:a(()=>[t(D,{modelValue:E.value,"onUpdate:modelValue":e[0]||(e[0]=l=>E.value=l),"prepend-inner-icon":"mdi-magnify",label:"Zoeken","single-line":"","hide-details":"",rounded:"none",density:"comfortable",clearable:""},null,8,["modelValue"])]),_:1}),t(c,{cols:"2",class:"text-right"},{default:a(()=>[t(u,{color:"primary","prepend-icon":"mdi-plus",onClick:e[1]||(e[1]=l=>P.value=!0)},{default:a(()=>e[15]||(e[15]=[n(" Nieuw Project ")])),_:1,__:[15]})]),_:1})]),_:1})]),_:1}),t(ue,{headers:Q,items:L(g).projects,search:E.value,loading:m.value,class:"elevation-1","item-value":"id"},{"item.ProjectLeider":a(({item:l})=>[l.ProjectLeider?(p(),y("span",we,b(l.ProjectLeider.Name),1)):(p(),y("span",Ie,"-"))]),"item.StartDate":a(({item:l})=>[n(b(l.StartDate?new Date(l.StartDate).toLocaleDateString():"-"),1)]),"item.EndDate":a(({item:l})=>[n(b(l.EndDate?new Date(l.EndDate).toLocaleDateString():"-"),1)]),"item.ProjectLocatie":a(({item:l})=>[n(b(l.ProjectLocatie||"-"),1)]),"item.Deelorders":a(({item:l})=>[f("div",Le,[t(ce,{class:"deelorders-group"},{default:a(()=>[(p(!0),y(J,null,Z(l.Deelorders,i=>(p(),w(H,{key:i,size:"small",variant:"outlined",color:"primary",class:"mr-1",label:""},{default:a(()=>[n(b(i),1)]),_:2},1024))),128))]),_:2},1024)])]),"item.actions":a(({item:l})=>[t(u,{icon:"mdi-pencil",variant:"text",size:"small",color:"primary",onClick:i=>ee(l)},null,8,["onClick"]),W(t(u,{icon:"mdi-delete",variant:"text",size:"small",color:"error",onClick:i=>te(l)},null,8,["onClick"]),[[j,[{action:"manage",resourceType:"all"}]]])]),_:1},8,["items","search","loading"])]),_:1}),t(O,{modelValue:P.value,"onUpdate:modelValue":e[9]||(e[9]=l=>P.value=l),"max-width":"600px"},{default:a(()=>[t(S,null,{default:a(()=>[t(I,null,{default:a(()=>[f("span",Se,b(o.value.id?"Project Bewerken":"Nieuw Project"),1)]),_:1}),t(T,null,{default:a(()=>[t(K,null,{default:a(()=>[t(G,null,{default:a(()=>[t(c,{cols:"12",sm:"6"},{default:a(()=>[t(D,{rounded:"none",modelValue:o.value.ProjectNaam,"onUpdate:modelValue":e[2]||(e[2]=l=>o.value.ProjectNaam=l),label:"Projectnaam",rules:[k.required],required:""},null,8,["modelValue","rules"])]),_:1}),t(c,{cols:"12",sm:"6"},{default:a(()=>[t(D,{type:"number",rounded:"none",modelValue:o.value.NumberID,"onUpdate:modelValue":e[3]||(e[3]=l=>o.value.NumberID=l),label:"Projectnummer",rules:[k.required,k.numberID],required:""},null,8,["modelValue","rules"])]),_:1}),t(c,{cols:"12"},{default:a(()=>[t(me,{rounded:"none",modelValue:o.value.ProjectleiderId,"onUpdate:modelValue":e[4]||(e[4]=l=>o.value.ProjectleiderId=l),items:L(U).projectleiders,label:"Projectteam","item-title":"Name","item-value":"id",rules:[k.required],required:""},null,8,["modelValue","items","rules"])]),_:1}),t(c,{cols:"12",sm:"6"},{default:a(()=>[t(D,{rounded:"none",modelValue:o.value.StartDate,"onUpdate:modelValue":e[5]||(e[5]=l=>o.value.StartDate=l),label:"Startdatum",type:"date",rules:[k.required],required:""},null,8,["modelValue","rules"])]),_:1}),t(c,{cols:"12",sm:"6"},{default:a(()=>[t(D,{rounded:"none",modelValue:o.value.EndDate,"onUpdate:modelValue":e[6]||(e[6]=l=>o.value.EndDate=l),label:"Einddatum",type:"date"},null,8,["modelValue"])]),_:1}),t(c,{cols:"12"},{default:a(()=>[t(D,{rounded:"none",modelValue:o.value.ProjectLocatie,"onUpdate:modelValue":e[7]||(e[7]=l=>o.value.ProjectLocatie=l),label:"Projectlocatie",placeholder:"longitude,latitude",hint:"Bijvoorbeeld: 4.8951679,52.3702157","persistent-hint":"","append-inner-icon":"mdi-map-marker","onClick:appendInner":ne},null,8,["modelValue"])]),_:1}),t(c,{cols:"12"},{default:a(()=>[f("div",Ne,[e[16]||(e[16]=f("div",{class:"text-h6 mb-4"},"Deelorders",-1)),f("div",Ue,[t(D,{rounded:"lg",type:"number",modelValue:v.value,"onUpdate:modelValue":e[8]||(e[8]=l=>v.value=l),label:"Voeg deelorder toe",onKeyup:pe($,["enter"]),class:"flex-grow-1 mr-2","hide-details":"",variant:"outlined",density:"comfortable",placeholder:"Voer een deelorder in...","bg-color":"white","error-messages":v.value.trim()&&o.value.Deelorders.includes(v.value.trim())?"Deze deelorder bestaat al":""},null,8,["modelValue","error-messages"]),t(u,{color:"primary",icon:"mdi-plus",onClick:$,disabled:!v.value.trim()||o.value.Deelorders.includes(v.value.trim()),variant:"tonal",class:"rounded-lg"},null,8,["disabled"])]),t(fe,{group:""},{default:a(()=>[(p(!0),y(J,null,Z(o.value.Deelorders,(l,i)=>(p(),w(H,{key:l,closable:"","onClick:close":R=>Y(i),class:"ma-1",variant:"outlined",label:""},{default:a(()=>[n(b(l),1)]),_:2},1032,["onClick:close"]))),128))]),_:1}),o.value.Deelorders.length===0?(p(),y("div",Ee,"Nog geen deelorders toegevoegd")):ve("",!0)])]),_:1})]),_:1})]),_:1})]),_:1}),t(q,null,{default:a(()=>[t(_),t(u,{color:"error",variant:"text",onClick:h},{default:a(()=>e[17]||(e[17]=[n("Annuleren")])),_:1,__:[17]}),t(u,{color:"primary",variant:"text",onClick:ae,loading:m.value},{default:a(()=>e[18]||(e[18]=[n("Opslaan")])),_:1,__:[18]},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(O,{modelValue:x.value,"onUpdate:modelValue":e[10]||(e[10]=l=>x.value=l),"max-width":"500px"},{default:a(()=>[t(S,null,{default:a(()=>[t(I,{class:"text-h5"},{default:a(()=>e[19]||(e[19]=[n("Weet je zeker dat je dit project wilt verwijderen?")])),_:1,__:[19]}),t(T,null,{default:a(()=>e[20]||(e[20]=[n("Deze actie kan niet ongedaan worden gemaakt.")])),_:1,__:[20]}),t(q,null,{default:a(()=>[t(_),t(u,{color:"primary",variant:"text",onClick:M},{default:a(()=>e[21]||(e[21]=[n("Annuleren")])),_:1,__:[21]}),W((p(),w(u,{color:"error",variant:"text",onClick:le,loading:m.value},{default:a(()=>e[22]||(e[22]=[n("Verwijderen")])),_:1,__:[22]},8,["loading"])),[[j,[{action:"manage",resourceType:"all"}]]]),t(_)]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(O,{modelValue:V.value,"onUpdate:modelValue":e[13]||(e[13]=l=>V.value=l),"max-width":"800px"},{default:a(()=>[t(S,null,{default:a(()=>[t(I,null,{default:a(()=>[e[23]||(e[23]=f("span",{class:"text-h5"},"Selecteer Locatie",-1)),t(_),t(u,{icon:"mdi-close",variant:"text",onClick:F})]),_:1,__:[23]}),t(T,null,{default:a(()=>[f("div",ze,[t(L(xe),{ref_key:"locationMapRef",ref:z,zoom:B.value,"onUpdate:zoom":e[11]||(e[11]=l=>B.value=l),center:A.value,"onUpdate:center":e[12]||(e[12]=l=>A.value=l),"use-global-leaflet":!1,"max-zoom":18,options:{zoomControl:!0,attributionControl:!0},onClick:oe},{default:a(()=>[t(L(Ce),{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png","layer-type":"base",name:"OpenStreetMap"})]),_:1},8,["zoom","center"])]),e[24]||(e[24]=f("div",{class:"text-caption mt-2"},"Klik op de kaart om de locatie te selecteren",-1))]),_:1,__:[24]}),t(q,null,{default:a(()=>[t(_),t(u,{color:"error",variant:"text",onClick:F},{default:a(()=>e[25]||(e[25]=[n("Annuleren")])),_:1,__:[25]}),t(u,{color:"primary",variant:"text",onClick:re},{default:a(()=>e[26]||(e[26]=[n("Bevestigen")])),_:1,__:[26]})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}}}),Fe=De(Ae,[["__scopeId","data-v-3ef5c4be"]]);export{Fe as default};
