import{aY as y,g as F,aZ as P,W as b,X as B,c as g,w as t,b1 as I,o as u,a as i,b as A,ba as D,aR as k,e as f,aS as E,E as p,bJ as C,t as _,Z as j,N as h,P as z,y as J,G as U,I as Z,d as G,J as M,f as O,a4 as W,O as X,bc as Y,V as q,_ as H}from"./index-5wn-0GR-.js";const V={getAllTasks:async()=>(await y.get("/scheduler/tasks")).data,enableTask:async c=>await y.post(`/scheduler/enable/${c}`),disableTask:async c=>await y.post(`/scheduler/disable/${c}`),triggerTask:async c=>await y.post(`/scheduler/trigger/${c}`)},K={class:"d-flex align-center mt-2"},Q={key:0,class:"text-caption mr-4"},N={key:1,class:"text-caption"},ee=F({__name:"SchedulerTester",setup(c){const r=P(),v=b([]),m=b(!0),d=b(null),l=b({}),T=async()=>{var e,s;try{m.value=!0,d.value=null,v.value=await V.getAllTasks()}catch(a){d.value=((s=(e=a.response)==null?void 0:e.data)==null?void 0:s.error)||"Failed to fetch tasks",r.error({message:"Failed to fetch scheduler tasks"})}finally{m.value=!1}},$=async(e,s)=>{var a,o;r.promise({message:`${s?"Enabling":"Disabling"} ${e}`}),l.value[e]||(l.value[e]={}),l.value[e].toggle=!0;try{let n;s?n=await V.enableTask(e):n=await V.disableTask(e),console.log(n),r.resolvePromise({message:`Task ${e} ${s?"enabled":"disabled"} successfully`})}catch(n){d.value=((o=(a=n.response)==null?void 0:a.data)==null?void 0:o.error)||`Failed to ${s?"enable":"disable"} task`,r.rejectPromise({message:`Failed to ${s?"enable":"disable"} task ${e}`});const x=v.value.find(R=>R.name===e);x&&(x.enabled=!s)}finally{l.value[e]&&(l.value[e].toggle=!1)}},S=async e=>{var s,a;r.promise({message:`Triggering ${e}`}),l.value[e]||(l.value[e]={}),l.value[e].trigger=!0;try{await V.triggerTask(e),r.resolvePromise({message:`Task ${e} triggered successfully`}),await T()}catch(o){d.value=((a=(s=o.response)==null?void 0:s.data)==null?void 0:a.error)||"Failed to trigger task",r.rejectPromise({message:`Failed to trigger task ${e}`})}finally{l.value[e]&&(l.value[e].trigger=!1)}},w=e=>new Date(e).toLocaleString(),L=e=>({running:"primary",completed:"success",failed:"error",pending:"warning",disabled:"grey"})[e.toLowerCase()]||"grey";return B(T),(e,s)=>(u(),g(I,null,{default:t(()=>[i(q,null,{default:t(()=>[i(A,{cols:"12"},{default:t(()=>[i(D,null,{default:t(()=>[i(k,{class:"text-h5"},{default:t(()=>s[0]||(s[0]=[f("Scheduler Tester")])),_:1,__:[0]}),i(E,null,{default:t(()=>[d.value?(u(),g(C,{key:0,type:"error",variant:"tonal",closable:"",class:"mb-4"},{default:t(()=>[f(_(d.value),1)]),_:1})):p("",!0),v.value.length>0?(u(),g(j,{key:1},{default:t(()=>[(u(!0),h(X,null,z(v.value,a=>(u(),g(J,{key:a.name,value:a},{prepend:t(()=>{var o;return[i(W,{modelValue:a.enabled,"onUpdate:modelValue":[n=>a.enabled=n,n=>$(a.name,n)],color:"primary","hide-details":"",loading:(o=l.value[a.name])==null?void 0:o.toggle},null,8,["modelValue","onUpdate:modelValue","loading"])]}),append:t(()=>{var o;return[i(O,{color:"primary",variant:"tonal",size:"small",loading:(o=l.value[a.name])==null?void 0:o.trigger,onClick:n=>S(a.name)},{default:t(()=>s[1]||(s[1]=[f(" Trigger Now ")])),_:2,__:[1]},1032,["loading","onClick"])]}),default:t(()=>[i(U,{class:"text-subtitle-1 font-weight-bold mb-1"},{default:t(()=>[f(_(a.name),1)]),_:2},1024),i(Z,null,{default:t(()=>[G("div",K,[i(M,{size:"small",color:L(a.status),class:"mr-2"},{default:t(()=>[f(_(a.status),1)]),_:2},1032,["color"]),a.lastRun?(u(),h("span",Q," Last Run: "+_(w(a.lastRun)),1)):p("",!0),a.nextRun?(u(),h("span",N," Next Run: "+_(w(a.nextRun)),1)):p("",!0)])]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:1})):p("",!0),m.value?(u(),g(Y,{key:2,indeterminate:"",color:"primary"})):p("",!0),!m.value&&v.value.length===0?(u(),g(C,{key:3,type:"info",variant:"tonal"},{default:t(()=>s[2]||(s[2]=[f(" No scheduled tasks found. ")])),_:1,__:[2]})):p("",!0)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}))}}),se=H(ee,[["__scopeId","data-v-1788dbec"]]);export{se as default};
