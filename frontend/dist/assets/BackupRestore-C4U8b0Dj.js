import{g as T,a3 as A,W as v,S as C,a9 as D,X as E,ck as F,c as L,w as t,b1 as j,o as f,a,aR as g,d as c,t as l,aS as _,bJ as z,e as i,u as d,ba as k,N as b,E as h,cx as q,f as w,bo as H,y as J,bC as K,bD as O,bK as W,bc as X,_ as G}from"./index-5wn-0GR-.js";import{u as Q,I,U as Y}from"./backup_store-DZOvVjBz.js";import{c as U}from"./createVueComponent-CKxNTOnQ.js";/**
 * @license @tabler/icons-vue v3.34.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Z=U("outline","alert-triangle","IconAlertTriangle",[["path",{d:"M12 9v4",key:"svg-0"}],["path",{d:"M10.363 3.591l-8.106 13.534a1.914 1.914 0 0 0 1.636 2.871h16.214a1.914 1.914 0 0 0 1.636 -2.87l-8.106 -13.536a1.914 1.914 0 0 0 -3.274 0z",key:"svg-1"}],["path",{d:"M12 16h.01",key:"svg-2"}]]);/**
 * @license @tabler/icons-vue v3.34.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var ee=U("outline","upload","IconUpload",[["path",{d:"M4 17v2a2 2 0 0 0 2 2h12a2 2 0 0 0 2 -2v-2",key:"svg-0"}],["path",{d:"M7 9l5 -5l5 5",key:"svg-1"}],["path",{d:"M12 4l0 12",key:"svg-2"}]]);const ae={class:"d-flex align-center"},te={key:0,class:"d-flex align-center"},se={class:"text-body-2"},le={key:0,class:"d-flex flex-column"},re={class:"text-subtitle-1"},oe={class:"text-caption"},ne={class:"d-flex flex-column"},ce={class:"text-caption"},ue={key:0,class:"mt-4"},ie={class:"white--text"},de=T({__name:"BackupRestore",setup(pe){const N=F(),r=Q(),{t:y}=A(),u=v(null),p=C(()=>r.restoreProgress),R=C(()=>r.loading&&r.currentOperation==="restoring"),n=v(null),m=v(!1);D(()=>r.restoreProgress,e=>{e.status==="completed"&&setTimeout(()=>{r.restoreProgress={status:"",progress:0}},2e3)},{deep:!0}),E(async()=>{r.backups.length||await r.listBackups();const e=N.params.selectedBackupId;e&&r.backups.length&&(u.value=r.backups.find(s=>s.id===e)||null)});const $=async()=>{var e;(e=u.value)!=null&&e.id&&confirm(y("admin.backup.confirm_restore"))&&await r.restoreBackup(u.value.id)},V=e=>{if(!e)return"";try{return new Date(e).toLocaleString()}catch{return""}},P=e=>{const s=e.target;s.files&&s.files.length>0&&(n.value=s.files[0])},x=()=>{n.value=null;const e=document.querySelector('input[type="file"]');e&&(e.value="")},M=async()=>{var e;if(n.value&&confirm(y("admin.backup.confirm_restore"))){m.value=!0;try{const s=await Y(n.value);if((e=s.data.data)!=null&&e.id)await r.restoreBackup(s.data.data.id),x();else throw new Error("No backup ID received from server")}catch(s){console.error("Upload failed:",s),r.$state.restoreProgress={status:"error",progress:0}}finally{m.value=!1}}};return(e,s)=>(f(),L(j,null,{default:t(()=>[a(k,{class:"mb-4"},{default:t(()=>[a(g,{class:"d-flex align-center justify-space-between"},{default:t(()=>[c("span",null,l(e.$t("admin.backup.restore_title")),1)]),_:1}),a(_,null,{default:t(()=>{var B;return[a(z,{type:"warning",variant:"tonal",class:"mb-4"},{default:t(()=>[c("div",ae,[a(d(Z),{class:"mr-2"}),i(" "+l(e.$t("admin.backup.restore_warning")),1)])]),_:1}),a(k,{variant:"outlined",class:"mb-4"},{default:t(()=>[a(g,{class:"d-flex align-center"},{default:t(()=>[a(d(ee),{class:"mr-2"}),i(" "+l(e.$t("admin.backup.upload_title")),1)]),_:1}),a(_,null,{default:t(()=>[a(q,{modelValue:n.value,"onUpdate:modelValue":s[0]||(s[0]=o=>n.value=o),label:e.$t("admin.backup.select_file"),accept:".json,.backup",onChange:P,"prepend-icon":"",class:"mb-2"},null,8,["modelValue","label"]),n.value?(f(),b("div",te,[c("span",se,l(n.value.name),1),a(w,{color:"error",variant:"text",class:"ml-2",onClick:x},{default:t(()=>[i(l(e.$t("common.clear")),1)]),_:1}),a(w,{color:"warning",loading:m.value,disabled:!n.value,onClick:M,class:"ml-2"},{default:t(()=>[a(d(I),{class:"mr-2"}),i(" "+l(e.$t("admin.backup.start_restore")),1)]),_:1},8,["loading","disabled"])])):h("",!0)]),_:1})]),_:1}),a(k,{variant:"outlined",class:"mb-4"},{default:t(()=>[a(g,null,{default:t(()=>[i(l(e.$t("admin.backup.select_backup")),1)]),_:1}),a(_,null,{default:t(()=>[a(H,{modelValue:u.value,"onUpdate:modelValue":s[1]||(s[1]=o=>u.value=o),items:d(r).backups,"item-title":"fileName","item-value":"id",class:"mb-4","menu-props":{maxHeight:"400px"},rounded:"none"},{selection:t(({item:o})=>[o!=null&&o.raw?(f(),b("div",le,[c("div",re,l(o.raw.fileName),1),c("div",oe,l(V(o.raw.createdAt)),1)])):h("",!0)]),item:t(({item:o,props:S})=>[a(J,K(O(S)),{title:t(()=>[c("div",ne,[c("div",null,l(o.raw.fileName),1),c("div",ce,l(V(o.raw.createdAt)),1)])]),_:2},1040)]),_:1},8,["modelValue","items"])]),_:1})]),_:1}),a(w,{color:"warning",loading:R.value,disabled:!((B=u.value)!=null&&B.id),onClick:$,class:"mb-4"},{default:t(()=>[a(d(I),{class:"mr-2"}),i(" "+l(e.$t("admin.backup.start_restore")),1)]),_:1},8,["loading","disabled"]),a(W,{name:"fade"},{default:t(()=>[p.value.status?(f(),b("div",ue,[a(X,{"model-value":p.value.progress,color:"warning",height:"20",striped:""},{default:t(()=>[c("span",ie,l(p.value.status)+" - "+l(p.value.progress)+"%",1)]),_:1},8,["model-value"])])):h("",!0)]),_:1})]}),_:1})]),_:1})]),_:1}))}}),ge=G(de,[["__scopeId","data-v-ec4a86a0"]]);export{ge as default};
