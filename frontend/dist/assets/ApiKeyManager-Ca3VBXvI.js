import{aY as C,br as ne,W as u,aZ as Q,S as N,bq as h,g as ue,X as de,c as R,w as s,b1 as pe,o as q,a as t,b as ve,cn as me,u as V,d as z,E as J,f as g,an as W,e as i,J as X,al as Z,t as D,V as fe,ba as S,aR as P,aS as E,b2 as G,ac as H,b3 as b,bu as K,bp as ce,bv as I,ae as U,_ as ye}from"./index-CRgOuqdl.js";import{_ as ge}from"./BaseBreadcrumb.vue_vue_type_style_index_0_lang-oQzYD9gG.js";import{_ as Ae}from"./UiParentCard.vue_vue_type_script_setup_true_lang-1FnjXCzn.js";const $={list:async()=>(await C.get("/users/api-keys")).data.data,create:async m=>(await C.post("/users/api-keys",m)).data.data,update:async(m,d)=>(await C.patch(`/users/api-keys/${m}`,{name:d})).data.data,revoke:async m=>{await C.delete(`/users/api-keys/${m}`)}},A=h.global.t,xe=ne("apiKeys",()=>{const m=u([]),d=u(!1),o=u(null),f=Q(),T=N(()=>m.value.filter(r=>r.isActive)),L=N(()=>m.value.filter(r=>r.isExpired)),F=N(()=>m.value.filter(r=>r.isExpiringSoon&&!r.isExpired)),M=r=>{const p=new Date,n={...r};if(r.expiresAt){const c=new Date(r.expiresAt).getTime()-p.getTime(),v=Math.ceil(c/(1e3*60*60*24));n.expiresIn=v,n.isExpired=v<=0,n.isExpiringSoon=v>0&&v<=7}return n},y=async()=>{d.value=!0,o.value=null;try{const r=await $.list();m.value=r.map(M)}catch(r){o.value=r.message,f.error({message:A("errors.fetch_error",{error:r.message})})}finally{d.value=!1}};return{apiKeys:m,isLoading:d,error:o,activeKeys:T,expiredKeys:L,expiringSoonKeys:F,fetchApiKeys:y,createApiKey:async(r,p)=>{d.value=!0,o.value=null,f.promise({message:A("saving.saving")});try{const n=await $.create({name:r,expiresAt:p});return await y(),f.resolvePromise({message:A("success.api_key_created")}),n}catch(n){throw o.value=n.message,f.rejectPromise({message:A("errors.create_error",{error:n.message})}),n}finally{d.value=!1}},updateApiKey:async(r,p)=>{d.value=!0,o.value=null,f.promise({message:A("saving.saving")});try{await $.update(r,p),await y(),f.resolvePromise({message:A("success.api_key_updated")})}catch(n){throw o.value=n.message,f.rejectPromise({message:A("errors.update_error ",{error:n.message})}),n}finally{d.value=!1}},revokeApiKey:async r=>{d.value=!0,o.value=null,f.promise({message:A("saving.saving")});try{await $.revoke(r),await y(),f.resolvePromise({message:A("success.api_key_revoked")})}catch(p){throw o.value=p.message,f.rejectPromise({message:A("errors.revoke_error",{error:p.message})}),p}finally{d.value=!1}}}}),we={class:"d-flex gap-2"},ke=ue({__name:"ApiKeyManager",setup(m){const d=h.global.t,o=xe(),f=Q(),T=l=>l.expiresAt?l.isExpired?"Expired":l.isExpiringSoon?`Expires in ${l.expiresIn} days`:new Date(l.expiresAt).toLocaleDateString():"Never",L=l=>l.expiresAt?l.isExpired?"error":l.isExpiringSoon?"warning":"success":"info",F=l=>{if(!l.lastUsedAt)return!1;const e=new Date(l.lastUsedAt);return Math.ceil((new Date().getTime()-e.getTime())/(1e3*60*60*24))>30},M=[{title:"Name",key:"name",sortable:!0,width:"25%"},{title:"Created",key:"createdAt",sortable:!0,width:"15%"},{title:"Last Used",key:"lastUsedAt",sortable:!0,width:"15%",tooltip:"Keys unused for 30+ days are highlighted"},{title:"Expires",key:"expiresAt",sortable:!0,width:"20%"},{title:"Status",key:"isActive",sortable:!0,width:"15%"},{title:"Actions",key:"actions",sortable:!1,width:"10%"}],y=u(!1),x=u(!1),w=u(!1),k=u(!1),r=u(!1),p=u(!1),n=u(),B=u(),c=u({name:"",expiresAt:null}),v=u({id:"",name:"",expiresAt:null}),_=u(""),ee=u({title:"API Keys"}),ae=u([{title:"Admin",disabled:!1,href:"/"},{title:"API Keys",disabled:!0,href:"#"}]),te=N(()=>{const l=new Date;return l.setDate(l.getDate()+1),l.toISOString().split("T")[0]}),se=()=>{c.value={name:"",expiresAt:null},y.value=!0},j=async()=>{try{const l=await o.createApiKey(c.value.name,c.value.expiresAt?new Date(c.value.expiresAt):void 0);y.value=!1,_.value=l.key,k.value=!0}catch{}},le=l=>{v.value={id:l.id,name:l.name,expiresAt:l.expiresAt},x.value=!0},O=async()=>{try{await o.updateApiKey(v.value.id,v.value.name),x.value=!1}catch{}},re=l=>{v.value={...l},w.value=!0},oe=async()=>{try{await o.revokeApiKey(v.value.id),w.value=!1}catch{}},ie=async()=>{try{await navigator.clipboard.writeText(_.value),f.info({message:d("success.copied_to_clipboard")})}catch{f.error({message:d("errors.copy_failed")})}};return de(()=>{o.fetchApiKeys()}),(l,e)=>(q(),R(pe,null,{default:s(()=>[t(ge,{title:ee.value.title,breadcrumbs:ae.value},null,8,["title","breadcrumbs"]),t(fe,null,{default:s(()=>[t(ve,{cols:"12"},{default:s(()=>[t(Ae,{title:"API Keys"},{action:s(()=>[t(g,{color:"primary","prepend-icon":"mdi-plus",onClick:se},{default:s(()=>e[19]||(e[19]=[i(" Add API Key ")])),_:1,__:[19]})]),default:s(()=>[t(me,{headers:M,items:V(o).apiKeys,loading:V(o).isLoading,hover:""},{"item.expiresAt":s(({item:a})=>[t(X,{color:L(a),size:"small"},{default:s(()=>[i(D(T(a)),1)]),_:2},1032,["color"])]),"item.createdAt":s(({item:a})=>[i(D(new Date(a.createdAt).toLocaleDateString()),1)]),"item.lastUsedAt":s(({item:a})=>[z("span",{class:Z({"text-warning":F(a)})},D(a.lastUsedAt?new Date(a.lastUsedAt).toLocaleDateString():"Never"),3)]),"item.isActive":s(({item:a})=>[t(X,{color:a.isActive?"success":"error",size:"small",class:Z({"pulse-animation":a.isExpiringSoon})},{default:s(()=>[i(D(a.isActive?"Active":"Revoked"),1)]),_:2},1032,["color","class"])]),"item.actions":s(({item:a})=>[z("div",we,[a.isActive?(q(),R(g,{key:0,icon:"",variant:"text",color:"secondary",size:"small",onClick:Y=>le(a)},{default:s(()=>[t(W,null,{default:s(()=>e[20]||(e[20]=[i("mdi-pencil")])),_:1,__:[20]})]),_:2},1032,["onClick"])):J("",!0),a.isActive?(q(),R(g,{key:1,icon:"",variant:"text",color:"error",size:"small",onClick:Y=>re(a)},{default:s(()=>[t(W,null,{default:s(()=>e[21]||(e[21]=[i("mdi-delete")])),_:1,__:[21]})]),_:2},1032,["onClick"])):J("",!0)])]),_:1},8,["items","loading"])]),_:1})]),_:1})]),_:1}),t(K,{modelValue:y.value,"onUpdate:modelValue":e[9]||(e[9]=a=>y.value=a),"max-width":"500px"},{default:s(()=>[t(S,null,{default:s(()=>[t(P,{class:"text-h5 pa-4"},{default:s(()=>e[22]||(e[22]=[i(" Create API Key ")])),_:1,__:[22]}),t(E,{class:"pa-4"},{default:s(()=>[t(G,{ref_key:"createForm",ref:n,onSubmit:H(j,["prevent"])},{default:s(()=>[t(b,{modelValue:c.value.name,"onUpdate:modelValue":e[0]||(e[0]=a=>c.value.name=a),label:"Name",required:"",rules:[a=>!!a||"Name is required"],rounded:!1},null,8,["modelValue","rules"]),t(b,{modelValue:c.value.expiresAt,"onUpdate:modelValue":e[1]||(e[1]=a=>c.value.expiresAt=a),label:"Expiration Date (Optional)",readonly:"",clearable:"","onClick:clear":e[2]||(e[2]=a=>c.value.expiresAt=null),rounded:!1,onClick:e[3]||(e[3]=a=>r.value=!0),"append-inner-icon":"mdi-calendar","onClick:appendInner":e[4]||(e[4]=a=>r.value=!0)},null,8,["modelValue"]),t(K,{modelValue:r.value,"onUpdate:modelValue":e[7]||(e[7]=a=>r.value=a),width:"auto","close-on-content-click":!1},{default:s(()=>[t(ce,{modelValue:c.value.expiresAt,"onUpdate:modelValue":[e[5]||(e[5]=a=>c.value.expiresAt=a),e[6]||(e[6]=a=>r.value=!1)],min:te.value},null,8,["modelValue","min"])]),_:1},8,["modelValue"])]),_:1},512)]),_:1}),t(I,{class:"pa-4"},{default:s(()=>[t(U),t(g,{color:"grey-darken-1",variant:"text",onClick:e[8]||(e[8]=a=>y.value=!1)},{default:s(()=>e[23]||(e[23]=[i(" Cancel ")])),_:1,__:[23]}),t(g,{color:"primary",onClick:j,loading:V(o).isLoading},{default:s(()=>e[24]||(e[24]=[i(" Create ")])),_:1,__:[24]},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(K,{modelValue:k.value,"onUpdate:modelValue":e[13]||(e[13]=a=>k.value=a),"max-width":"500px"},{default:s(()=>[t(S,null,{default:s(()=>[t(P,{class:"text-h5 pa-4"},{default:s(()=>e[25]||(e[25]=[i(" API Key Created ")])),_:1,__:[25]}),t(E,{class:"pa-4"},{default:s(()=>[e[26]||(e[26]=z("p",{class:"mb-4"},"Please copy your API key now. You won't be able to see it again!",-1)),t(b,{modelValue:_.value,"onUpdate:modelValue":e[10]||(e[10]=a=>_.value=a),label:"API Key",readonly:"","append-icon":"mdi-content-copy","onClick:append":ie,class:"monospace-font",rounded:!1,"append-inner-icon":p.value?"mdi-eye-off":"mdi-eye","onClick:appendInner":e[11]||(e[11]=a=>p.value=!p.value),type:p.value?"text":"password"},null,8,["modelValue","append-inner-icon","type"])]),_:1,__:[26]}),t(I,{class:"pa-4"},{default:s(()=>[t(U),t(g,{color:"primary",onClick:e[12]||(e[12]=a=>k.value=!1)},{default:s(()=>e[27]||(e[27]=[i(" Close ")])),_:1,__:[27]})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(K,{modelValue:x.value,"onUpdate:modelValue":e[16]||(e[16]=a=>x.value=a),"max-width":"500px"},{default:s(()=>[t(S,null,{default:s(()=>[t(P,{class:"text-h5 pa-4"},{default:s(()=>e[28]||(e[28]=[i(" Edit API Key ")])),_:1,__:[28]}),t(E,{class:"pa-4"},{default:s(()=>[t(G,{ref_key:"editForm",ref:B,onSubmit:H(O,["prevent"])},{default:s(()=>[t(b,{modelValue:v.value.name,"onUpdate:modelValue":e[14]||(e[14]=a=>v.value.name=a),label:"Name",required:"",rules:[a=>!!a||"Name is required"],rounded:!1},null,8,["modelValue","rules"]),t(b,{value:v.value.expiresAt?new Date(v.value.expiresAt).toLocaleDateString():"Never",label:"Expiration Date",readonly:"",disabled:"",rounded:!1},null,8,["value"])]),_:1},512)]),_:1}),t(I,{class:"pa-4"},{default:s(()=>[t(U),t(g,{color:"grey-darken-1",variant:"text",onClick:e[15]||(e[15]=a=>x.value=!1)},{default:s(()=>e[29]||(e[29]=[i(" Cancel ")])),_:1,__:[29]}),t(g,{color:"primary",onClick:O,loading:V(o).isLoading},{default:s(()=>e[30]||(e[30]=[i(" Save ")])),_:1,__:[30]},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(K,{modelValue:w.value,"onUpdate:modelValue":e[18]||(e[18]=a=>w.value=a),"max-width":"400px"},{default:s(()=>[t(S,null,{default:s(()=>[t(P,{class:"text-h5 pa-4"},{default:s(()=>e[31]||(e[31]=[i(" Revoke API Key ")])),_:1,__:[31]}),t(E,{class:"pa-4"},{default:s(()=>e[32]||(e[32]=[i(" Are you sure you want to revoke this API key? This action cannot be undone. ")])),_:1,__:[32]}),t(I,{class:"pa-4"},{default:s(()=>[t(U),t(g,{color:"grey-darken-1",variant:"text",onClick:e[17]||(e[17]=a=>w.value=!1)},{default:s(()=>e[33]||(e[33]=[i(" Cancel ")])),_:1,__:[33]}),t(g,{color:"error",onClick:oe,loading:V(o).isLoading},{default:s(()=>e[34]||(e[34]=[i(" Revoke ")])),_:1,__:[34]},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}}),_e=ye(ke,[["__scopeId","data-v-ec49527c"]]);export{_e as default};
