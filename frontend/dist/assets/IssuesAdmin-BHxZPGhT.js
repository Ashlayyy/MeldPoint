import{p as $e}from"./purify.es-CEVJ7K31.js";import{m as we}from"./marked.esm-DKjyhwJX.js";import{br as xe,a3 as ge,aZ as Ae,a1 as ve,W as b,S as be,g as Te,bs as Pe,cw as ze,a9 as ie,X as Le,c as $,w as a,b1 as Ue,o as v,a as t,b as W,d,N as V,u as o,P as H,ba as T,aS as P,by as ne,O as R,t as u,an as J,e as h,V as re,bo as Y,b3 as Be,cn as Oe,v as ue,f as U,z as ce,J as Q,aR as ee,a0 as q,E as X,ae as de,cl as Re,ap as me,bz as pe,b4 as fe,bg as Ee,bv as Ne,bu as De,cQ as Ge,_ as Me}from"./index-5wn-0GR-.js";import{G as He,a as qe,U as je,A as Fe}from"./github-CLxWdIIs.js";import{_ as We}from"./UiParentCard.vue_vue_type_script_setup_true_lang-DQjgUtM8.js";const Je=xe("githubIssues",()=>{const{t:y}=ge(),m=Ae(),E=ve(),f=b([]),N=b(0),D=b(!1),G=b([]),w=b({state:"open",type:void 0,search:"",labels:"",page:1,limit:50,sortBy:"state",sortOrder:"asc"}),k=b(null),r=b(!1),M=b(!1),Z=be(()=>Math.ceil(N.value/(w.value.limit||10)));async function S(){D.value=!0;try{const l=await He(w.value);console.log("API Response for GetIssues (response.data):",l),l&&l.data&&l.meta?(f.value=l.data,N.value=l.meta.total):(console.error("Unexpected structure in GetIssues response (after type update):",l),f.value=[],N.value=0)}catch(l){console.error("Failed to load issues:",l),m.error({title:y("admin.github.issues.load_error_title")||"Error Loading Issues",message:y("admin.github.issues.load_error_message")||"Could not fetch issues from the server."})}finally{D.value=!1}}async function z(){M.value=!0;try{const l=await qe();if(console.log("API Response for GetIssueStats (response.data):",l),l&&l.data){const n=l.data.open||0,p=l.data.closed||0;G.value=[{state:"open",_count:n},{state:"closed",_count:p}]}else console.error("Unexpected structure in GetIssueStats response:",l),G.value=[]}catch(l){console.error("Failed to load stats:",l)}finally{M.value=!1}}function B(l){let n=!1;const p=w.value,g={...p};l.page!==void 0&&l.page!==p.page&&(g.page=l.page,n=!0),l.limit!==void 0&&l.limit!==p.limit&&(g.limit=l.limit,n=!0),l.sortBy!==void 0&&l.sortBy!==p.sortBy&&(g.sortBy=l.sortBy,n=!0),l.sortOrder!==void 0&&l.sortOrder!==p.sortOrder&&(g.sortOrder=l.sortOrder,n=!0),n?(console.log("updateFilters: Changes detected, fetching...",l),w.value=g,S()):console.log("updateFilters: No changes detected, skipping fetch.",l)}function C(l){let n=!1;const p=w.value,g=l.state||"all",I=l.labels,L=l.search;g!==p.state&&(n=!0),I!==p.labels&&(n=!0),L!==p.search&&(n=!0),p.page!==1&&(n=!0),n?(console.log("applyFilters: Changes detected or page reset needed, fetching...",l),w.value={...p,state:g,labels:I,search:L,page:1},S()):console.log("applyFilters: No changes detected and page already 1, skipping fetch.",l)}function x(l){k.value=l}async function _(l,n,p){try{return await je(l,n,p),m.info({title:y(`admin.github.issues.${n}_success_title`)||`Issue ${n.charAt(0).toUpperCase()+n.slice(1)}`,message:y(`admin.github.issues.${n}_success_message`)||"Issue status updated successfully."}),await Promise.all([S(),z()]),!0}catch(g){return console.error(`Failed to update issue status to ${n}:`,g),m.error({title:y(`admin.github.issues.${n}_error_title`)||"Status Update Error",message:y(`admin.github.issues.${n}_error_message`)||"Could not update issue status."}),!1}}async function j(l,n,p){var g,I;r.value=!0,m.promise({title:y("admin.github.issues.closing_title")||"Closing Issue",message:y("admin.github.issues.closing_message")||"Attempting to close the issue..."});try{const L=`
 Melding afgesloten door ${((g=E.user)==null?void 0:g.Name)||((I=E.user)==null?void 0:I.Email)}.
 Reden: ${n}
 Bericht: ${p}`;if(await _(l,"closed",{reason:n,comment:L}))return m.resolvePromise({title:y("admin.github.issues.close_success_title")||"Issue Closed",message:y("admin.github.issues.close_success_message")||"The issue has been successfully closed."}),x(null),!0;throw new Error("UpdateIssueStatus failed")}catch{return m.rejectPromise({title:y("admin.github.issues.close_error_title")||"Error Closing Issue",message:y("admin.github.issues.close_error_message")||"There was an error closing the issue."}),!1}finally{r.value=!1}}async function A(l){var g,I;const n=`Issue reopened by ${((g=E.user)==null?void 0:g.Name)||((I=E.user)==null?void 0:I.Email)}`,p=await _(l,"open",{comment:n});return p&&x(null),p}return{issues:f,total:N,loading:D,issueStats:G,filters:w,selectedIssue:k,closingIssue:r,statsLoading:M,totalPages:Z,fetchIssues:S,fetchStats:z,updateFilters:B,applyFilters:C,setSelectedIssue:x,updateIssueStatus:_,closeIssue:j,reopenIssue:A}}),Qe={class:"d-flex gap-4 mb-6"},Xe={class:"d-flex align-center justify-space-between"},Ze={class:"text-subtitle-1 mb-1"},Ke={class:"text-h4"},Ye=["onClick"],es={class:"d-flex flex-wrap gap-1"},ss={class:"d-flex align-center"},ts={class:"d-flex gap-2"},as={class:"d-flex align-center"},ls={class:"d-flex align-center flex-wrap gap-2 mb-4"},os={class:"text-caption"},is={class:"text-h6 mb-4"},ns=["innerHTML"],rs={key:0,class:"d-flex align-center gap-2"},us={class:"text-subtitle-2"},cs={class:"text-caption text-medium-emphasis"},ds={key:1,class:"text-caption text-medium-emphasis"},ms={class:"d-flex align-start gap-3 mb-2"},ps={class:"font-weight-medium mr-2"},fs={class:"text-caption text-medium-emphasis"},gs=["innerHTML"],vs={key:0},bs={class:"text-subtitle-1 mb-3"},hs=Te({__name:"IssuesAdmin",setup(y){const{t:m}=ge(),E=[{title:m("admin.github.issues.table.title"),key:"title",sortable:!0},{title:m("admin.github.issues.table.status"),key:"state",sortable:!0},{title:m("admin.github.issues.table.labels"),key:"labels",sortable:!1},{title:m("admin.github.issues.table.created"),key:"createdAt",sortable:!0},{title:m("admin.github.issues.table.actions"),key:"actions",sortable:!1}],f=Je(),{issues:N,total:D,loading:G,issueStats:w,filters:k,selectedIssue:r,closingIssue:M,statsLoading:Z}=Pe(f),S=b(k.value.state),z=b(k.value.labels),B=b(k.value.search),C=b(!1),x=b(!1),_=b({type:"Other",comment:""}),j=b(""),A=b(""),l=b(!1),n=ve(),p=ze(),g=s=>{switch(s){case"open":return"success";case"closed":return"error";default:return"grey"}},I=s=>{switch(s){case"open":return"mdi-checkbox-blank-circle-outline";case"closed":return"mdi-checkbox-marked-circle";default:return"mdi-help-circle"}},L=s=>{switch(s){case"bug":return"mdi-bug";case"feature":return"mdi-lightbulb";case"documentation":return"mdi-file-document";default:return"mdi-help-circle"}},se=s=>{switch(s){case"bug":return"error";case"feature":return"success";case"documentation":return"info";default:return"grey"}},he=async s=>{var i,e;if(s.state==="open"){const c=`Closed by: ${((i=n.user)==null?void 0:i.Name)||((e=n.user)==null?void 0:e.Email)}`;await f.updateIssueStatus(s.id,"closed",{comment:c})}else await f.reopenIssue(s.id);C.value&&(C.value=!1)},te=async s=>{f.setSelectedIssue(s),x.value=!1,_.value={type:"Other",comment:""},A.value="",l.value=!1,C.value=!0,j.value=await ke(s.body||"")},_e=s=>{f.updateFilters({page:s})},F=s=>{if(!s)return m("myIssues.labels.na");try{return Ge(new Date(s),"PPpp")}catch(i){return console.error("Error formatting date:",s,i),m("myIssues.labels.na")}},ye=["Duplicate","Invalid","wont_fix","Completed","Not Needed","Other"],ke=async s=>{const i=s.replace(/\r\n/g,`
`).replace(/\n{2,}/g,"§PARAGRAPH§").replace(/\n/g,"<br>").replace(/§PARAGRAPH§/g,`

`),e=await we(i||"");return $e.sanitize(e,{ALLOWED_TAGS:["p","br","strong","em","ul","ol","li","code","pre","blockquote","a","h1","h2","h3","h4","h5","h6","hr","img"],ALLOWED_ATTR:["href","src"]})},Ie=s=>s?s.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r\n|\n|\r/g,"<br />"):"",ae=s=>s?s.filter(i=>i.name.toLowerCase()!=="helpdesk"):[],le=s=>{if(!(!s||s.toLowerCase()==="ededed"))return/^[0-9A-F]{6}$/i.test(s)?"#"+s:s},Ce=async()=>{if(!(!r.value||!A.value.trim())){l.value=!0;try{await Fe(r.value.id,A.value.trim()),await f.fetchIssues(),A.value=""}catch(s){console.error("Failed to submit admin comment:",s)}finally{l.value=!1}}},oe=be(()=>!!_.value.type&&_.value.comment.trim().length>=3),Ve=async()=>{if(!oe.value||!r.value)return;await f.closeIssue(r.value.id,_.value.type,_.value.comment.trim())&&(C.value=!1,x.value=!1,_.value={type:"Other",comment:""})},Se=async()=>{if(!r.value)return;await f.reopenIssue(r.value.id)&&(C.value=!1)},K=b(null);return ie([S,z,B],([s,i,e])=>{K.value&&clearTimeout(K.value),K.value=setTimeout(()=>{f.applyFilters({state:s||void 0,labels:i||void 0,search:e||void 0})},300)}),ie(()=>({state:k.value.state,labels:k.value.labels,search:k.value.search}),s=>{S.value!==s.state&&(S.value=s.state),z.value!==s.labels&&(z.value=s.labels),B.value!==s.search&&(B.value=s.search)},{deep:!0}),Le(()=>{f.fetchIssues(),f.fetchStats(),p.on("issue:created",()=>{console.log("Socket event: issue:created received"),Promise.all([f.fetchIssues(),f.fetchStats()])}),p.on("issue:updated",()=>{console.log("Socket event: issue:updated received"),Promise.all([f.fetchIssues(),f.fetchStats()])})}),(s,i)=>(v(),$(Ue,null,{default:a(()=>[t(re,null,{default:a(()=>[t(W,{cols:"12"},{default:a(()=>[t(We,{title:s.$t("admin.github.issues.title")},{default:a(()=>[d("div",Qe,[o(Z)?(v(),V(R,{key:0},H(3,e=>t(T,{key:`skel-${e}`,class:"stat-card flex-grow-1"},{default:a(()=>[t(P,null,{default:a(()=>[t(ne,{type:"list-item-two-line"})]),_:1})]),_:2},1024)),64)):(v(!0),V(R,{key:1},H(o(w),e=>(v(),$(T,{key:e.state,class:"stat-card flex-grow-1"},{default:a(()=>[t(P,null,{default:a(()=>{var c,O;return[d("div",Xe,[d("div",null,[d("div",Ze,u(((c=e.state)==null?void 0:c.charAt(0).toUpperCase())+((O=e.state)==null?void 0:O.slice(1))),1),d("div",Ke,u(e._count),1)]),t(J,{color:g(e.state),size:"40"},{default:a(()=>[h(u(I(e.state)),1)]),_:2},1032,["color"])])]}),_:2},1024)]),_:2},1024))),128))]),t(T,{class:"mb-6",variant:"outlined"},{default:a(()=>[t(P,null,{default:a(()=>[t(re,{align:"center"},{default:a(()=>[t(W,{cols:"12",sm:"3"},{default:a(()=>[t(Y,{modelValue:S.value,"onUpdate:modelValue":i[0]||(i[0]=e=>S.value=e),items:["all","open","closed"],label:s.$t("admin.github.issues.filter.status"),density:"comfortable",variant:"outlined","hide-details":"",clearable:"","item-props":e=>({prependIcon:I(e),prependIconColor:g(e)})},null,8,["modelValue","label","item-props"])]),_:1}),t(W,{cols:"12",sm:"3"},{default:a(()=>[t(Y,{modelValue:z.value,"onUpdate:modelValue":i[1]||(i[1]=e=>z.value=e),items:["bug","feature","documentation"],label:s.$t("admin.github.issues.filter.type"),density:"comfortable",variant:"outlined","hide-details":"",clearable:"","item-props":e=>({prependIcon:L(e)})},null,8,["modelValue","label","item-props"])]),_:1}),t(W,{cols:"12",sm:"3"},{default:a(()=>[t(Be,{modelValue:B.value,"onUpdate:modelValue":i[2]||(i[2]=e=>B.value=e),label:s.$t("admin.github.issues.filter.search"),density:"comfortable",variant:"outlined","hide-details":"","prepend-inner-icon":"mdi-magnify",clearable:""},null,8,["modelValue","label"])]),_:1})]),_:1})]),_:1})]),_:1}),t(Oe,{headers:E,items:o(N),loading:o(G),"items-per-page":o(k).limit||50,page:o(k).page,"items-length":o(D),"server-items-length":o(D),"show-select":!1,"sort-by":[{key:o(k).sortBy||"state",order:o(k).sortOrder||"asc"}],"onUpdate:page":_e,"onUpdate:itemsPerPage":i[3]||(i[3]=e=>o(f).updateFilters({limit:e})),"onUpdate:sortBy":i[4]||(i[4]=e=>{var c,O;return o(f).updateFilters({sortBy:(c=e[0])==null?void 0:c.key,sortOrder:(O=e[0])==null?void 0:O.order})}),"items-per-page-options":[{value:50,title:"50"},{value:100,title:"100"}],hover:""},{"item.title":a(({item:e})=>[d("div",{class:"text-truncate",onClick:c=>te(e),style:{cursor:"pointer"}},u(e.title),9,Ye)]),"item.state":a(({item:e})=>[t(Q,{color:g(e.state),size:"small",variant:"flat","prepend-icon":I(e.state)},{default:a(()=>[h(u(o(m)(`myIssues.states.${e.state}`)),1)]),_:2},1032,["color","prepend-icon"])]),"item.labels":a(({item:e})=>[d("div",es,[(v(!0),V(R,null,H(ae(e.labels),c=>(v(),$(Q,{key:c.name,size:"x-small",variant:"tonal",color:le(c.color)},{default:a(()=>[h(u(c.name),1)]),_:2},1032,["color"]))),128))])]),"item.createdAt":a(({item:e})=>[d("div",ss,[t(J,{size:"small",class:"mr-2"},{default:a(()=>i[12]||(i[12]=[h("mdi-calendar")])),_:1,__:[12]}),h(" "+u(F(e.created_at)),1)])]),"item.actions":a(({item:e})=>[d("div",ts,[t(ue,{text:s.$t(e.state==="open"?"admin.github.issues.actions.close":"admin.github.issues.actions.reopen")},{activator:a(({props:c})=>[t(U,ce(c,{icon:e.state==="open"?"mdi-check-circle":"mdi-refresh",size:"small",color:e.state==="open"?"success":"info",variant:"flat",onClick:O=>he(e)}),null,16,["icon","color","onClick"])]),_:2},1032,["text"]),t(ue,{text:s.$t("admin.github.issues.actions.view_details")},{activator:a(({props:c})=>[t(U,ce(c,{icon:"mdi-eye",size:"small",color:"primary",variant:"flat",onClick:O=>te(e)}),null,16,["onClick"])]),_:2},1032,["text"])])]),_:1},8,["items","loading","items-per-page","page","items-length","server-items-length","sort-by"])]),_:1},8,["title"])]),_:1})]),_:1}),t(De,{modelValue:C.value,"onUpdate:modelValue":i[11]||(i[11]=e=>C.value=e),"max-width":"800"},{default:a(()=>[t(T,null,{default:a(()=>[t(ee,{class:"d-flex justify-space-between align-center pa-4"},{default:a(()=>{var e;return[d("div",as,[t(J,{color:se((e=o(r))==null?void 0:e.type),size:"24",class:"mr-2"},{default:a(()=>{var c;return[h(u(L((c=o(r))==null?void 0:c.type)),1)]}),_:1},8,["color"]),d("span",null,u(s.$t("admin.github.issues.details_title")),1)]),t(U,{icon:"mdi-close",variant:"text",onClick:i[5]||(i[5]=c=>C.value=!1)})]}),_:1}),t(q),t(P,{class:"pa-4"},{default:a(()=>[o(r)?(v(),V(R,{key:0},[d("div",ls,[t(Q,{color:g(o(r).state),size:"small",variant:"flat","prepend-icon":I(o(r).state)},{default:a(()=>[h(u(o(m)(`myIssues.states.${o(r).state}`)),1)]),_:1},8,["color","prepend-icon"]),(v(!0),V(R,null,H(ae(o(r).labels),e=>(v(),$(Q,{key:e.name,size:"small",variant:"outlined",color:le(e.color),class:"text-capitalize"},{default:a(()=>[h(u(e.name),1)]),_:2},1032,["color"]))),128)),t(de),d("div",os,[t(J,{size:"small",class:"mr-1"},{default:a(()=>i[13]||(i[13]=[h("mdi-calendar")])),_:1,__:[13]}),h(" "+u(o(m)("myIssues.labels.created"))+": "+u(F(o(r).created_at)),1)])]),d("div",is,u(o(r).title),1),t(T,{variant:"outlined",class:"mb-4"},{default:a(()=>[t(P,null,{default:a(()=>[(v(),$(Re,null,{fallback:a(()=>[t(ne,{type:"article"})]),default:a(()=>[d("div",{class:"markdown-body",innerHTML:j.value},null,8,ns)]),_:1}))]),_:1})]),_:1}),t(T,{variant:"outlined",class:"mb-4"},{default:a(()=>[t(P,null,{default:a(()=>[o(r).user?(v(),V("div",rs,[t(me,{size:"32"},{default:a(()=>[t(pe,{src:o(r).user.avatar_url||"/images/default-avatar.png"},null,8,["src"])]),_:1}),d("div",null,[d("div",us,u(o(r).user.login),1),d("div",cs,u(o(m)("admin.github.issues.created_by"))+" "+u(F(o(r).created_at)),1)])])):(v(),V("div",ds,u(o(m)("admin.github.issues.creator_unknown")),1))]),_:1})]),_:1}),o(r).comments&&o(r).comments.length>0?(v(),$(T,{key:0,variant:"outlined",class:"mb-4"},{default:a(()=>[t(ee,{class:"text-subtitle-2"},{default:a(()=>[h(u(o(m)("myIssues.details.commentsTitle",{count:o(r).comments.length})),1)]),_:1}),t(q),t(P,null,{default:a(()=>[(v(!0),V(R,null,H(o(r).comments,(e,c)=>(v(),V("div",{key:e.id||c,class:"comment mb-4"},[d("div",ms,[t(me,{size:"32"},{default:a(()=>[t(pe,{src:e.user.avatar_url||"/images/default-avatar.png",alt:e.user.login},null,8,["src","alt"])]),_:2},1024),d("div",null,[d("span",ps,u(e.user.login),1),d("span",fs,u(F(e.created_at)),1)])]),d("div",{class:"pl-11 markdown-body",innerHTML:Ie(e.body)},null,8,gs),c<o(r).comments.length-1?(v(),$(q,{key:0,class:"mt-4"})):X("",!0)]))),128))]),_:1})]),_:1})):X("",!0),t(T,{variant:"outlined",class:"mb-4"},{default:a(()=>[t(ee,{class:"text-subtitle-2"},{default:a(()=>[h(u(o(m)("myIssues.details.addCommentTitle")),1)]),_:1}),t(q),t(P,null,{default:a(()=>[t(fe,{modelValue:A.value,"onUpdate:modelValue":i[6]||(i[6]=e=>A.value=e),label:o(m)("myIssues.details.commentPlaceholder"),variant:"outlined",rows:"3","auto-grow":"","hide-details":"auto",class:"mb-3"},null,8,["modelValue","label"]),t(U,{color:"primary",onClick:Ce,disabled:!A.value.trim(),loading:l.value,block:""},{default:a(()=>[h(u(o(m)("myIssues.buttons.submitComment")),1)]),_:1},8,["disabled","loading"])]),_:1})]),_:1}),t(Ee,null,{default:a(()=>[x.value?(v(),V("div",vs,[t(T,{variant:"outlined"},{default:a(()=>[t(P,null,{default:a(()=>[d("div",bs,u(s.$t("admin.github.issues.close_issue")),1),t(Y,{modelValue:_.value.type,"onUpdate:modelValue":i[7]||(i[7]=e=>_.value.type=e),items:ye,label:s.$t("admin.github.issues.close_reason"),"item-title":e=>s.$t(`admin.github.issues.close_reasons.${e}`),density:"comfortable",variant:"outlined",class:"mb-3",rules:[e=>!!e||s.$t("admin.github.issues.reason_required")],required:""},null,8,["modelValue","label","item-title","rules"]),t(fe,{modelValue:_.value.comment,"onUpdate:modelValue":i[8]||(i[8]=e=>_.value.comment=e),label:s.$t("admin.github.issues.close_comment"),placeholder:s.$t("admin.github.issues.close_comment_placeholder"),density:"comfortable",variant:"outlined",rows:"3",class:"mb-3",rules:[e=>!!e||s.$t("admin.github.issues.comment_required")],required:""},null,8,["modelValue","label","placeholder","rules"])]),_:1})]),_:1})])):X("",!0)]),_:1})],64)):X("",!0)]),_:1}),t(q),t(Ne,{class:"pa-4"},{default:a(()=>{var e;return[t(U,{color:"error",variant:"text",onClick:i[9]||(i[9]=c=>C.value=!1)},{default:a(()=>[h(u(s.$t("general.cancel")),1)]),_:1}),t(de),((e=o(r))==null?void 0:e.state)==="open"?(v(),V(R,{key:0},[x.value?(v(),$(U,{key:1,color:"error",variant:"flat","prepend-icon":"mdi-check-circle",disabled:!oe.value,onClick:Ve,loading:o(M)},{default:a(()=>[h(u(s.$t("admin.github.issues.confirm_close")),1)]),_:1},8,["disabled","loading"])):(v(),$(U,{key:0,color:"warning",variant:"flat","prepend-icon":"mdi-close-circle",onClick:i[10]||(i[10]=c=>x.value=!0)},{default:a(()=>[h(u(s.$t("admin.github.issues.close_issue")),1)]),_:1}))],64)):(v(),$(U,{key:1,color:"primary",variant:"flat","prepend-icon":"mdi-refresh",onClick:Se},{default:a(()=>[h(u(s.$t("admin.github.issues.actions.reopen")),1)]),_:1}))]}),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}}),Vs=Me(hs,[["__scopeId","data-v-d4c3c2b9"]]);export{Vs as default};
