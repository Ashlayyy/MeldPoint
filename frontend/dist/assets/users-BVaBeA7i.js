import{u as ne}from"./user_store-CU4ETWmY.js";import{u as ue}from"./permissions_store-CsOR62Oh.js";import{u as de}from"./department_store-Pqw-lHPr.js";import{_ as me}from"./BaseBreadcrumb.vue_vue_type_style_index_0_lang-BOmi3NWL.js";import{_ as ve}from"./UiParentCard.vue_vue_type_script_setup_true_lang-DQjgUtM8.js";import{g as ce,a3 as fe,aZ as pe,W as m,S as G,X as ge,c as Ve,w as t,b1 as be,o as we,a as e,b as W,cn as _e,u as $,d as V,t as r,e as u,f as b,an as E,ap as ye,V as j,b3 as De,ba as x,aR as K,aS as M,bv as O,ae as X,bu as Z,aK as Ue,aL as I,aO as Ce,aP as A,bo as R,_ as $e}from"./index-5wn-0GR-.js";import{u as Te}from"./userNameSplit-BbEHBQq1.js";const ke={class:"d-flex align-center"},Ie={class:"user-avatar"},Ae={class:"text-subtitle-1"},Re={class:"d-flex gap-2"},Se=ce({__name:"users",setup(he){const{t:v}=fe(),c=ne(),i=ue(),w=de(),N=pe(),T=m(""),_=m(!1),S=m(!1),P=m([]),y=m(!1),k=m("roles"),D=m([]),U=m([]),C=m([]),h=m(!1),f=m(""),q=m({title:v("admin.users.pageTitle")}),H=m([{title:v("admin.title"),disabled:!1,href:"/"},{title:v("admin.users.pageTitle"),disabled:!0,href:"#"}]),J=G(()=>[{title:v("admin.users.table.user"),key:"avatar",align:"start",sortable:!1},{title:v("admin.users.table.email"),key:"Email",align:"start",sortable:!0},{title:v("admin.users.table.department"),key:"Department",align:"start",sortable:!0},{title:v("admin.users.table.lastLogin"),key:"lastLogin",align:"start",sortable:!0},{title:v("admin.users.table.createdAt"),key:"CreatedAt",align:"start",sortable:!0},{title:v("admin.users.table.actions"),key:"actions",align:"start",sortable:!1}]),d=m({}),Q=G(()=>Array.isArray(c.users)?c.users.filter(a=>{var l,n,p;if(!a)return!1;const s=T.value.toLowerCase();return(((l=a.Name)==null?void 0:l.toLowerCase())||"").includes(s)||(((n=a.Email)==null?void 0:n.toLowerCase())||"").includes(s)||(((p=a.Department)==null?void 0:p.toLowerCase())||"").includes(s)}):[]);ge(async()=>{await c.fetchUsers({limit:2e4}),await i.fetchRoles(),await i.fetchGroups(),await i.fetchPermissions(),await w.initializeData()});const Y=a=>{d.value={...a},_.value=!0},ee=async()=>{S.value=!0;try{await c.deleteUser(d.value.id),_.value=!1}catch(a){console.warn(a),N.error({message:v("errors.delete_error",{error:a||"Delete error"})})}finally{S.value=!1}},z=a=>a?new Date(a).toLocaleString():"N/A",ae=G(()=>w.departments.map(a=>({title:a.name,value:a.id}))),le=async a=>{var s,l,n,p;d.value={...a},D.value=((s=a.userRoles)==null?void 0:s.map(g=>g.roleId))||[],U.value=((l=a.userGroups)==null?void 0:l.map(g=>g.groupId))||[],C.value=((n=a.userPermissions)==null?void 0:n.map(g=>g.permissionId))||[],f.value=((p=a.Department)==null?void 0:p.id)||"",y.value=!0},te=async()=>{var a,s,l;h.value=!0;try{const n=((a=d.value.userRoles)==null?void 0:a.map(o=>o.roleId))||[],p=D.value.filter(o=>!n.includes(o)),g=n.filter(o=>!D.value.includes(o));for(const o of p)await i.assignRoleToUser(o,d.value.id);for(const o of g)await i.removeRoleFromUser(o,d.value.id);const B=((s=d.value.userGroups)==null?void 0:s.map(o=>o.groupId))||[],se=U.value.filter(o=>!B.includes(o)),oe=B.filter(o=>!U.value.includes(o));for(const o of se)await i.assignGroupToUser(o,d.value.id);for(const o of oe)await i.removeGroupFromUser(o,d.value.id);const F=((l=d.value.userPermissions)==null?void 0:l.map(o=>o.permissionId))||[],re=C.value.filter(o=>!F.includes(o)),ie=F.filter(o=>!C.value.includes(o));for(const o of re)await i.assignToUser(d.value.id,o);for(const o of ie)await i.removeFromUser(d.value.id,o);const L=w.departments.find(o=>o.name===d.value.Department);f.value!==(L==null?void 0:L.id)&&f.value!==""&&f.value!==null&&(await c.updateUserDepartment(d.value.id,f.value),await w.fetchDepartments()),await c.fetchUsers({limit:2e4}),await i.fetchRoles(),await i.fetchGroups(),await i.fetchPermissions(),await w.fetchDepartments(),y.value=!1}catch(n){N.error({message:v("errors.save_error",{error:n||"Save error"})})}finally{h.value=!1}};return(a,s)=>(we(),Ve(be,null,{default:t(()=>[e(me,{title:q.value.title,breadcrumbs:H.value},null,8,["title","breadcrumbs"]),e(j,null,{default:t(()=>[e(W,{cols:"12"},{default:t(()=>[e(ve,{title:a.$t("admin.users.title")},{action:t(()=>[e(j,{class:"align-center",justify:"end"},{default:t(()=>[e(W,{cols:"12",sm:"3"},{default:t(()=>[e(De,{modelValue:T.value,"onUpdate:modelValue":s[0]||(s[0]=l=>T.value=l),"hide-details":"",density:"compact",placeholder:a.$t("admin.users.table.search"),"prepend-inner-icon":"mdi-magnify",variant:"outlined",color:"primary"},null,8,["modelValue","placeholder"])]),_:1})]),_:1})]),default:t(()=>[e(_e,{headers:J.value,items:Q.value,search:T.value,loading:$(c).isLoading,hover:"","show-select":"",modelValue:P.value,"onUpdate:modelValue":s[1]||(s[1]=l=>P.value=l),"item-value":"id"},{"item.avatar":t(({item:l})=>[V("div",ke,[e(ye,{size:"40",class:"mr-3"},{default:t(()=>[V("div",Ie,r($(Te)(l)),1)]),_:2},1024),V("div",null,[V("h6",Ae,r(l.Name),1)])])]),"item.actions":t(({item:l})=>[V("div",Re,[e(b,{icon:"",variant:"text",color:"secondary",size:"small",onClick:n=>le(l)},{default:t(()=>[e(E,null,{default:t(()=>s[12]||(s[12]=[u("mdi-account-cog")])),_:1,__:[12]})]),_:2},1032,["onClick"]),e(b,{icon:"",variant:"text",color:"error",size:"small",onClick:n=>Y(l)},{default:t(()=>[e(E,null,{default:t(()=>s[13]||(s[13]=[u("mdi-delete")])),_:1,__:[13]})]),_:2},1032,["onClick"])])]),"item.lastLogin":t(({item:l})=>[u(r(z(l.lastLogin)),1)]),"item.CreatedAt":t(({item:l})=>[u(r(z(l.CreatedAt)),1)]),"item.Department":t(({item:l})=>{var n;return[V("span",null,r(((n=l.Department)==null?void 0:n.name)||"Not Assigned"),1)]}),_:2},1032,["headers","items","search","loading","modelValue"])]),_:1},8,["title"])]),_:1})]),_:1}),e(Z,{modelValue:_.value,"onUpdate:modelValue":s[3]||(s[3]=l=>_.value=l),"max-width":"400"},{default:t(()=>[e(x,null,{default:t(()=>[e(K,{class:"text-h5 pa-4"},{default:t(()=>[u(r(a.$t("admin.users.delete_user")),1)]),_:1}),e(M,{class:"pa-4"},{default:t(()=>[u(r(a.$t("admin.users.delete_confirmation_user")),1)]),_:1}),e(O,{class:"pa-4"},{default:t(()=>[e(X),e(b,{color:"grey-darken-1",variant:"text",onClick:s[2]||(s[2]=l=>_.value=!1)},{default:t(()=>[u(r(a.$t("general.actions.cancel")),1)]),_:1}),e(b,{color:"error",onClick:ee,loading:S.value},{default:t(()=>[u(r(a.$t("general.actions.delete")),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(Z,{modelValue:y.value,"onUpdate:modelValue":s[11]||(s[11]=l=>y.value=l),"max-width":"600"},{default:t(()=>[e(x,null,{default:t(()=>[e(K,{class:"text-h5 pa-4"},{default:t(()=>[u(r(a.$t("admin.users.manage_user_access")),1)]),_:1}),e(M,{class:"pa-4"},{default:t(()=>[e(Ue,{modelValue:k.value,"onUpdate:modelValue":s[4]||(s[4]=l=>k.value=l)},{default:t(()=>[e(I,{value:"roles"},{default:t(()=>[u(r(a.$t("admin.users.dialog.roles")),1)]),_:1}),e(I,{value:"groups"},{default:t(()=>[u(r(a.$t("admin.users.dialog.groups")),1)]),_:1}),e(I,{value:"permissions"},{default:t(()=>[u(r(a.$t("admin.users.dialog.permissions")),1)]),_:1}),e(I,{value:"department"},{default:t(()=>[u(r(a.$t("admin.users.dialog.department")),1)]),_:1})]),_:1},8,["modelValue"]),e(Ce,{modelValue:k.value,"onUpdate:modelValue":s[9]||(s[9]=l=>k.value=l),class:"mt-4"},{default:t(()=>[e(A,{value:"roles"},{default:t(()=>[e(R,{rounded:"none",modelValue:D.value,"onUpdate:modelValue":s[5]||(s[5]=l=>D.value=l),items:$(i).roles,"item-title":"name","item-value":"id",multiple:"",chips:"",label:a.$t("admin.users.dialog.selectRoles")},null,8,["modelValue","items","label"])]),_:1}),e(A,{value:"groups"},{default:t(()=>[e(R,{rounded:"none",modelValue:U.value,"onUpdate:modelValue":s[6]||(s[6]=l=>U.value=l),items:$(i).groups,"item-title":"name","item-value":"id",multiple:"",chips:"",label:a.$t("admin.users.dialog.selectGroups")},null,8,["modelValue","items","label"])]),_:1}),e(A,{value:"permissions"},{default:t(()=>[e(R,{rounded:"none",modelValue:C.value,"onUpdate:modelValue":s[7]||(s[7]=l=>C.value=l),items:$(i).permissions,"item-title":"name","item-value":"id",multiple:"",chips:"",label:a.$t("admin.users.dialog.selectPermissions")},null,8,["modelValue","items","label"])]),_:1}),e(A,{value:"department"},{default:t(()=>[e(R,{rounded:"none",modelValue:f.value,"onUpdate:modelValue":s[8]||(s[8]=l=>f.value=l),items:ae.value,"item-title":"title","item-value":"value",label:a.$t("admin.users.dialog.selectDepartment")},null,8,["modelValue","items","label"])]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(O,{class:"pa-4"},{default:t(()=>[e(X),e(b,{color:"grey-darken-1",variant:"text",onClick:s[10]||(s[10]=l=>y.value=!1)},{default:t(()=>[u(r(a.$t("general.actions.cancel")),1)]),_:1}),e(b,{color:"primary",onClick:te,loading:h.value},{default:t(()=>[u(r(a.$t("general.actions.save")),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}}),We=$e(Se,[["__scopeId","data-v-72a54c6a"]]);export{We as default};
