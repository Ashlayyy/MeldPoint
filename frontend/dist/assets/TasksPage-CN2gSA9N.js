import{g as X,W as D,S as p,c as j,o as f,ba as J,w as n,a as s,d as t,ae as Ae,a4 as Pe,aR as Me,N as V,E as N,u as ie,bb as Ne,_ as Q,V as me,P as te,b as Z,aS as be,b0 as je,al as ee,t as S,bc as Oe,O as ae,bd as De,be as Ee,z as oe,v as fe,bf as ze,ac as se,J as ne,e as P,an as G,f as ue,bg as Fe,a0 as Be,bh as xe,a9 as Re,X as _e,bi as qe,bj as Le,bk as Ke,bl as He,bm as Ge,bn as We,bo as le,ag as ve,bp as pe,b3 as ge,aL as ke,aK as Je,aO as Xe,aP as ye,b5 as ce,bq as Qe,a1 as Ye,b1 as Ze,am as et}from"./index-5wn-0GR-.js";import{u as tt}from"./task_store-Djeon91P.js";import{u as we,a as at}from"./status_store-D-AYfpW7.js";import{u as Se}from"./user_store-CU4ETWmY.js";import{u as lt}from"./pageStore-nxijD_tr.js";const st={class:"px-4 pb-2"},nt={class:"d-flex flex-wrap gap-3"},ot={key:0,class:"legend-item d-flex align-center"},it=X({__name:"TodoCalendarCard",props:{tasks:{type:Array,required:!0}},emits:["day-click"],setup(u,{emit:O}){const i=u,y=O,w=D(!0),I=D(null),U=k=>{const r=new Date(k.deadline),M=new Date;return k.finished?"green":r<M?"red":k.category==="correctief"?"blue":"purple"};function m(k,r=30){return k.length>r?`${k.slice(0,r)}...`:k}const g=p(()=>{const k=[];return k.push({key:"today",dates:new Date,highlight:{color:"primary",fillMode:"solid"},popover:{label:"Today"}}),i.tasks&&Array.isArray(i.tasks)&&i.tasks.filter(r=>r.deadline&&(!r.finished||w.value)).forEach(r=>{k.push({key:`task-${r.id}`,dates:new Date(r.deadline),dot:{color:U(r),style:{backgroundColor:U(r),size:16}},popover:{label:m(r.message),visibility:"hover"},customData:{id:r.id,type:"task",category:r.action,completed:r.finished}})}),k});function T(k){y("day-click",k.date)}return(k,r)=>(f(),j(J,{class:"mb-6",elevation:"0"},{default:n(()=>[s(Me,{class:"d-flex align-center py-2"},{default:n(()=>[r[1]||(r[1]=t("h3",{class:"text-h6"},"Kalender",-1)),s(Ae),s(Pe,{modelValue:w.value,"onUpdate:modelValue":r[0]||(r[0]=M=>w.value=M),label:"Toon afgeronde taken",color:"success","hide-details":"",density:"compact",class:"ma-0 pa-0"},null,8,["modelValue"])]),_:1,__:[1]}),t("div",st,[t("div",nt,[r[3]||(r[3]=t("div",{class:"legend-item d-flex align-center"},[t("div",{class:"legend-dot",style:{"background-color":"red"}}),t("span",{class:"text-caption"},"Overschreden")],-1)),w.value?(f(),V("div",ot,r[2]||(r[2]=[t("div",{class:"legend-dot",style:{"background-color":"green"}},null,-1),t("span",{class:"text-caption"},"Afgerond",-1)]))):N("",!0),r[4]||(r[4]=t("div",{class:"legend-item d-flex align-center"},[t("div",{class:"legend-dot",style:{"background-color":"#1976d2"}}),t("span",{class:"text-caption"},"Correctief")],-1)),r[5]||(r[5]=t("div",{class:"legend-item d-flex align-center"},[t("div",{class:"legend-dot",style:{"background-color":"#9c27b0"}}),t("span",{class:"text-caption"},"Preventief")],-1))])]),s(ie(Ne),{locale:"nl",attributes:g.value,expanded:"","show-weeknumbers":"",onDayclick:T,ref_key:"calendarRef",ref:I,class:"calendar-container"},null,8,["attributes"])]),_:1}))}}),rt=Q(it,[["__scopeId","data-v-33e95932"]]),dt={class:"text-medium-emphasis text-subtitle-2 font-weight-medium"},ut={class:"text-h3 my-2"},ct=X({__name:"TodoKPISection",props:{kpiItems:{type:Array,required:!0}},emits:["kpi-click"],setup(u,{emit:O}){const i=u,y=O;function w(U){y("kpi-click",U)}function I(U){const m=i.kpiItems.find(T=>T.title==="Totaal"),g=(m==null?void 0:m.value)||0;return!g||g===0?0:U/g*100}return(U,m)=>(f(),j(J,{elevation:"0",class:"mb-4"},{default:n(()=>[s(J,{variant:"outlined"},{default:n(()=>[s(me,null,{default:n(()=>[(f(!0),V(ae,null,te(i.kpiItems,(g,T)=>(f(),j(Z,{cols:"12",sm:"6",lg:"3",key:T},{default:n(()=>[s(be,{class:ee({"cursor-pointer kpi-card":g.clickable}),onClick:k=>g.clickable?w(g):null,style:je(g.clickable?"transition: all 0.2s ease-in-out;":"")},{default:n(()=>[t("span",dt,S(g.title),1),t("h3",ut,S(g.value),1),s(Oe,{"model-value":g.title!=="Totaal"?I(g.value):100,color:g.color},null,8,["model-value","color"])]),_:2},1032,["class","onClick","style"])]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}))}}),mt=Q(ct,[["__scopeId","data-v-590da987"]]),ft={class:"checkbox-column"},vt={class:"task-details"},pt=["title"],gt={class:"task-meta"},kt={class:"meta-id-container"},yt={key:0,class:"meta-project"},ht={key:1,class:"meta-project"},Tt={class:"action-column"},bt={key:0,class:"days-overdue-container mr-2"},Dt={class:"action-buttons"},xt={key:0,class:"expanded-details"},_t={class:"expanded-content pl-0 pr-4 py-2"},wt={class:"details-container"},St={class:"details-column"},Vt={class:"detail-item"},Ct={class:"detail-value"},It={class:"detail-item"},$t={key:0,class:"overdue-text"},Ut={key:0,class:"detail-item"},At={class:"detail-value"},Pt={class:"details-column"},Mt={key:0,class:"detail-item"},Nt={class:"detail-label"},jt={class:"detail-value"},Ot={key:1,class:"detail-item"},Et={class:"detail-value"},zt={key:2,class:"detail-item"},Ft={class:"detail-value"},Bt={key:0,class:"notes-container mt-3"},Rt={class:"notes-text"},qt={key:1,class:"task-actions mt-3"},Lt=X({__name:"TodoTaskItem",props:{task:{type:Object,required:!0},statusCache:{type:Object,default:()=>({})},isHighlighted:{type:Boolean,default:!1},showDeadline:{type:Boolean,default:!1},expandedTaskId:{type:[String,null],default:null}},emits:["toggle-status","open-melding","open-url","more-menu","expand-task"],setup(u,{emit:O}){const i=u,y=O,w=De(),I=we(),U=p(()=>w.global.current.value.dark),m=p(()=>i.expandedTaskId===i.task.id);function g(){const h=m.value?null:i.task.id;y("expand-task",h)}const T=p(()=>!i.task.finished&&new Date(i.task.deadline)<new Date),k=p(()=>{const h=new Date(i.task.deadline),l=Math.abs(new Date().getTime()-h.getTime());return Math.floor(l/(1e3*60*60*24))}),r=p(()=>{var e;const h=`${i.task.category}-${i.task.correctiefId||i.task.preventiefId}`;return((e=i.statusCache[h])==null?void 0:e.StatusColor)??"grey"}),M=p(()=>{var e;const h=`${i.task.category}-${i.task.correctiefId||i.task.preventiefId}`;return((e=i.statusCache[h])==null?void 0:e.StatusNaam)||"N/A"}),_=p(()=>{switch(i.task.category){case"correctief":return"rgb(var(--v-theme-primary))";case"preventief":return"rgb(var(--v-theme-secondary))";default:return"warning"}}),C=p(()=>i.task.actionType==="traject"?"info":i.task.actionType==="task"?"success":"warning"),$=p(()=>{switch(i.task.actionType){case"traject":return"Melding";case"task":return"Actie";default:return"Onbekend"}});function H(h){if(!h)return"Onbekend";try{const e=I.getActiehouderById(h);return(e==null?void 0:e.Name)||`ID: ${h}`}catch(e){return console.error("Error fetching actiehouder name:",e),`ID: ${h}`}}const q=p(()=>i.task.userId?H(i.task.userId):"Niet toegewezen");function K(){y("open-url",i.task.url),W.value=!1}function z(h){return h?new Date(h).toLocaleDateString("nl-NL",{day:"2-digit",month:"2-digit",year:"numeric"}):"N/A"}const W=D(!1),B=p(()=>{const h=`${i.task.category}-${i.task.correctiefId||i.task.preventiefId}`,e=i.statusCache[h];return e!=null&&e.ProjectNumberID&&(e!=null&&e.Deelorder)?`${e.ProjectNumberID} DO${e.Deelorder}`:e!=null&&e.ProjectNumberID?e.ProjectNumberID:i.task.project?i.task.project:""}),L=p(()=>{const h=`${i.task.category}-${i.task.correctiefId||i.task.preventiefId}`,e=i.statusCache[h];return(e==null?void 0:e.PDCATitel)||"Onbekend"}),A=p({get:()=>i.task.finished,set:h=>{y("toggle-status",{...i.task,finished:h})}});return(h,e)=>(f(),j(Ee,null,{default:n(({isHovering:l,props:Y})=>[t("div",oe({class:"task-item"},Y,{class:{"elevation-1":l||m.value,exceeding:T.value,highlighted:u.isHighlighted,[u.task.category||""]:!!u.task.category,completed:u.task.finished,expanded:m.value}}),[t("div",{class:"task-content",onClick:g},[t("div",ft,[s(fe,{location:"top","content-class":"status-tooltip",disabled:u.task.finished},{activator:n(({props:v})=>[u.task.actionType!=="traject"?(f(),j(ze,oe({key:0,modelValue:A.value,"onUpdate:modelValue":e[0]||(e[0]=a=>A.value=a),onClick:e[1]||(e[1]=se(()=>{},["stop"])),color:_.value,"hide-details":""},v,{density:"compact"}),null,16,["modelValue","color"])):N("",!0)]),default:n(()=>[e[2]||(e[2]=t("span",null,"Voltooi actie",-1))]),_:1,__:[2]},8,["disabled"]),s(fe,{location:"top","content-class":"status-tooltip"},{activator:n(({props:v})=>[u.task.actionType==="traject"?(f(),j(ne,oe({key:0,class:"status-chip",color:r.value,dark:"",elevation:"1",density:"comfortable"},v,{onClick:se(g,["stop"]),style:{cursor:"pointer"}}),{default:n(()=>[t("p",{class:ee({blacktext:!U.value,whitetext:U.value})},S(M.value),3)]),_:2},1040,["color"])):N("",!0)]),default:n(()=>[e[3]||(e[3]=t("span",null,"Wijzig status in het Verbeterplein ",-1))]),_:1,__:[3]})]),t("div",vt,[t("div",{class:ee(["task-message",{"expanded-message":m.value}]),title:u.task.message},S(u.task.message),11,pt),t("div",gt,[t("div",kt,[s(ne,{size:"x-small",color:C.value,variant:"tonal",class:"meta-id-chip"},{default:n(()=>[P(S($.value),1)]),_:1},8,["color"]),u.task.category==="correctief"?(f(),V("span",yt,S(B.value),1)):N("",!0),u.task.category==="preventief"?(f(),V("span",ht,"PDCA: "+S(L.value),1)):N("",!0)])])]),t("div",Tt,[T.value?(f(),V("div",bt,[s(ne,{size:"x-small",color:"error",variant:"tonal"},{default:n(()=>[s(G,{size:"x-small",class:"mr-1"},{default:n(()=>e[4]||(e[4]=[P("mdi-clock-alert")])),_:1,__:[4]}),P(" "+S(k.value===0?"Deadline vandaag!":k.value+" dagen te laat"),1)]),_:1})])):N("",!0),s(ne,{size:"x-small",color:_.value,variant:"tonal",class:"category-chip mr-2"},{default:n(()=>[P(S(u.task.category||"onbekend"),1)]),_:1},8,["color"]),t("div",Dt,[s(ue,{icon:"",size:"small",variant:"text",color:"grey-darken-1",class:"action-btn",onClick:se(g,["stop"])},{default:n(()=>[s(G,null,{default:n(()=>[P(S(m.value?"mdi-chevron-up":"mdi-chevron-down"),1)]),_:1})]),_:1})])])]),s(Fe,null,{default:n(()=>[m.value?(f(),V("div",xt,[s(Be,{class:"my-2"}),t("div",_t,[t("div",wt,[t("div",St,[t("div",Vt,[e[5]||(e[5]=t("span",{class:"detail-label"},"Aangemaakt",-1)),t("span",Ct,S(z(u.task.createdAt)),1)]),t("div",It,[e[6]||(e[6]=t("span",{class:"detail-label"},"Deadline",-1)),t("span",{class:ee(["detail-value",{"error--text":T.value}])},[P(S(z(u.task.deadline))+" ",1),T.value?(f(),V("span",$t,"("+S(k.value)+" dagen te laat)",1)):N("",!0)],2)]),u.task.finished?(f(),V("div",Ut,[e[7]||(e[7]=t("span",{class:"detail-label"},"Afgerond op",-1)),t("span",At,S(z(u.task.completedAt)),1)])):N("",!0)]),t("div",Pt,[q.value?(f(),V("div",Mt,[t("span",Nt,S(u.task.actionType==="traject"?"Actiehouder":"Toegewezen aan"),1),t("span",jt,S(q.value),1)])):N("",!0),B.value&&u.task.category==="correctief"?(f(),V("div",Ot,[e[8]||(e[8]=t("span",{class:"detail-label"},"Project",-1)),t("span",Et,S(B.value),1)])):N("",!0),u.task.category==="preventief"?(f(),V("div",zt,[e[9]||(e[9]=t("span",{class:"detail-label"},"PDCA-titel",-1)),t("span",Ft,S(L.value),1)])):N("",!0)])]),u.task.notes?(f(),V("div",Bt,[e[10]||(e[10]=t("div",{class:"notes-header"},"Notities",-1)),t("div",Rt,S(u.task.notes),1)])):N("",!0),u.task.url?(f(),V("div",qt,[s(ue,{size:"small",color:"secondary",variant:"tonal",class:"open-link-btn",onClick:se(K,["stop"])},{default:n(()=>[s(G,{size:"small",class:"mr-1"},{default:n(()=>e[11]||(e[11]=[P("mdi-open-in-new")])),_:1,__:[11]}),e[12]||(e[12]=P(" Bekijk in Verbeterplein "))]),_:1,__:[12]})])):N("",!0)])])):N("",!0)]),_:1})],16)]),_:1}))}}),de=Q(Lt,[["__scopeId","data-v-c0ef49a5"]]),Kt=X({__name:"TodoTaskSegment",props:{title:{type:String,required:!0},segmentClass:{type:String,default:""},headerClass:{type:String,default:""},icon:{type:String,required:!0},iconColor:{type:String,required:!0},tasks:{type:Array,required:!0}},setup(u,{expose:O}){const i=D(null);return O({segmentRef:i}),(y,w)=>(f(),V("div",{class:ee(["task-segment",[u.segmentClass]]),ref_key:"segmentRef",ref:i},[t("div",{class:ee(["segment-header pa-4",[u.headerClass]])},[s(G,{color:u.iconColor,class:"mr-2"},{default:n(()=>[P(S(u.icon),1)]),_:1},8,["color"]),P(" "+S(u.title),1)],2),xe(y.$slots,"default",{},void 0,!0)],2))}}),he=Q(Kt,[["__scopeId","data-v-02df042c"]]),Ht=["data-date"],Gt={class:"tasks-section"},Wt=X({__name:"TodoDateGroup",props:{date:{type:String,required:!0},isToday:{type:Boolean,default:!1},isSelected:{type:Boolean,default:!1},formattedDate:{type:String,required:!0}},setup(u){return(O,i)=>(f(),V("div",null,[t("div",{class:ee(["date-header pa-2",{today:u.isToday,selected:u.isSelected}]),"data-date":u.date},S(u.formattedDate),11,Ht),t("div",Gt,[xe(O.$slots,"default",{},void 0,!0)])]))}}),Te=Q(Wt,[["__scopeId","data-v-0da6cd1f"]]),Jt={class:"filters"},Xt={class:"d-flex justify-space-between align-center w-100"},Qt={class:"d-flex align-center"},Yt={class:"d-flex align-center mb-1"},Zt={class:"d-flex align-center mb-1"},ea={class:"d-flex align-center mb-1"},ta={class:"d-flex gap-2 mb-1"},aa={class:"d-flex gap-2"},la={class:"d-flex align-center mb-1"},sa=X({__name:"TodoFilters",props:{initialFilters:{type:Object,default:()=>null},statusCache:{type:Object,default:()=>({})}},emits:["update-filters"],setup(u,{emit:O}){const i=De(),y=p(()=>i.global.current.value.dark);at();const w=Se(),I=u,U=O,m=D(1),g=D(null),T=D(null),k=D(null),r=D(null),M=D(null),_=D(null),C=D(null),$=D(null);Re(()=>I.initialFilters,e=>{e&&(g.value=e.actionType??null,T.value=e.category??null,k.value=e.itemStatus??null,r.value=e.meldingStatus??null,M.value=e.finished??null,_.value=e.startDate??null,C.value=e.endDate??null,$.value=e.userId??null)},{immediate:!0});const H=D(!1),q=D(!1),K=p(()=>_.value?new Date(_.value).toLocaleDateString("nl-NL"):""),z=p(()=>C.value?new Date(C.value).toLocaleDateString("nl-NL"):""),W=p(()=>g.value==="traject"),B=p(()=>{const e=new Set;return Object.values(I.statusCache).forEach(l=>{l&&l.StatusNaam&&e.add(l.StatusNaam)}),Array.from(e).sort()}),L=p(()=>!!(g.value||T.value||k.value||r.value||M.value!==null||_.value||C.value));_e(()=>{(!w.filterUsers||w.filterUsers.length===0)&&w.fetchFilterUsers()});function A(){U("update-filters",{actionType:g.value,category:T.value,itemStatus:k.value,meldingStatus:r.value,finished:M.value,startDate:_.value,endDate:C.value,userId:$.value})}function h(e){e.stopPropagation(),g.value=null,T.value=null,k.value=null,r.value=null,M.value=null,_.value=null,C.value=null,$.value=null,A()}return(e,l)=>{const Y=qe("permission");return f(),V("div",Jt,[s(Le,{modelValue:m.value,"onUpdate:modelValue":l[15]||(l[15]=v=>m.value=v)},{default:n(()=>[s(Ke,null,{default:n(()=>[s(He,null,{default:n(()=>[t("div",Xt,[l[19]||(l[19]=t("span",null,"Filters",-1)),t("div",Qt,[L.value?(f(),j(ne,{key:0,color:"primary",size:"x-small",class:"mr-4",variant:"flat"},{default:n(()=>l[16]||(l[16]=[P(" Actieve filters ")])),_:1,__:[16]})):N("",!0),L.value?(f(),j(ue,{key:1,color:"error",variant:"text",density:"compact",size:"small",onClick:se(h,["stop"])},{default:n(()=>[s(G,{size:"small",class:"mr-1"},{default:n(()=>l[17]||(l[17]=[P("mdi-close")])),_:1,__:[17]}),l[18]||(l[18]=P(" Wis filters "))]),_:1,__:[18]})):N("",!0)])])]),_:1}),s(Ge,null,{default:n(()=>[s(me,{dense:""},{default:n(()=>[s(Z,{cols:"12",sm:"6",md:"3",lg:"3"},{default:n(()=>[s(J,{variant:"outlined",class:"filter-group pa-2",theme:y.value?"dark":"light"},{default:n(()=>[t("div",Yt,[s(G,{size:"small",color:"primary",class:"mr-1"},{default:n(()=>l[20]||(l[20]=[P("mdi-format-list-bulleted")])),_:1,__:[20]}),l[21]||(l[21]=t("span",{class:"text-caption font-weight-medium"},"Taak Details",-1))]),s(le,{modelValue:g.value,"onUpdate:modelValue":[l[0]||(l[0]=v=>g.value=v),A],items:[{text:"Actie",value:"task"},{text:"Melding",value:"traject"}],label:"Type",density:"compact",variant:"outlined","hide-details":"",class:"mb-1",clearable:"","item-title":"text","item-value":"value"},null,8,["modelValue"]),s(le,{modelValue:T.value,"onUpdate:modelValue":[l[1]||(l[1]=v=>T.value=v),A],items:[{text:"Correctief",value:"correctief"},{text:"Preventief",value:"preventief"}],label:"Categorie",density:"compact",variant:"outlined","hide-details":"",class:"mb-1",clearable:"","item-title":"text","item-value":"value"},null,8,["modelValue"])]),_:1},8,["theme"])]),_:1}),s(Z,{cols:"12",sm:"6",md:"3",lg:"3"},{default:n(()=>[s(J,{variant:"outlined",class:"filter-group pa-2",theme:y.value?"dark":"light"},{default:n(()=>[t("div",Zt,[s(G,{size:"small",color:"primary",class:"mr-1"},{default:n(()=>l[22]||(l[22]=[P("mdi-flag-outline")])),_:1,__:[22]}),l[23]||(l[23]=t("span",{class:"text-caption font-weight-medium"},"Item Status",-1))]),s(le,{modelValue:r.value,"onUpdate:modelValue":[l[2]||(l[2]=v=>r.value=v),A],items:B.value,label:"Meldingstatus",density:"compact",variant:"outlined","hide-details":"",class:"mb-1",disabled:g.value==="task",clearable:""},null,8,["modelValue","items","disabled"]),s(le,{modelValue:M.value,"onUpdate:modelValue":[l[3]||(l[3]=v=>M.value=v),A],items:[{text:"Voltooid",value:!0},{text:"Niet voltooid",value:!1}],label:"Taakstatus",density:"compact",variant:"outlined","hide-details":"",class:"mb-1","item-title":"text","item-value":"value",clearable:"",disabled:W.value},null,8,["modelValue","disabled"])]),_:1},8,["theme"])]),_:1}),s(Z,{cols:"12",sm:"6",md:"3",lg:"3"},{default:n(()=>[s(J,{variant:"outlined",class:"filter-group pa-2",theme:y.value?"dark":"light"},{default:n(()=>[t("div",ea,[s(G,{size:"small",color:"primary",class:"mr-1"},{default:n(()=>l[24]||(l[24]=[P("mdi-calendar-outline")])),_:1,__:[24]}),l[25]||(l[25]=t("span",{class:"text-caption font-weight-medium"},"Datum",-1))]),t("div",ta,[s(ve,{modelValue:H.value,"onUpdate:modelValue":l[8]||(l[8]=v=>H.value=v),"close-on-content-click":!1,transition:"scale-transition","min-width":"auto"},{activator:n(({props:v})=>[s(ge,oe(v,{modelValue:K.value,"onUpdate:modelValue":l[4]||(l[4]=a=>K.value=a),label:"Van",density:"compact",variant:"outlined","hide-details":"",readonly:"",clearable:"","onClick:clear":l[5]||(l[5]=a=>{_.value=null,A()})}),null,16,["modelValue"])]),default:n(()=>[s(pe,{modelValue:_.value,"onUpdate:modelValue":[l[6]||(l[6]=v=>_.value=v),l[7]||(l[7]=v=>{H.value=!1,A()})]},null,8,["modelValue"])]),_:1},8,["modelValue"])]),t("div",aa,[s(ve,{modelValue:q.value,"onUpdate:modelValue":l[13]||(l[13]=v=>q.value=v),"close-on-content-click":!1,transition:"scale-transition","min-width":"auto"},{activator:n(({props:v})=>[s(ge,oe(v,{modelValue:z.value,"onUpdate:modelValue":l[9]||(l[9]=a=>z.value=a),label:"Tot",density:"compact",variant:"outlined","hide-details":"",readonly:"",clearable:"","onClick:clear":l[10]||(l[10]=a=>{C.value=null,A()})}),null,16,["modelValue"])]),default:n(()=>[s(pe,{modelValue:C.value,"onUpdate:modelValue":[l[11]||(l[11]=v=>C.value=v),l[12]||(l[12]=v=>{q.value=!1,A()})]},null,8,["modelValue"])]),_:1},8,["modelValue"])])]),_:1},8,["theme"])]),_:1}),We((f(),j(Z,{cols:"12",sm:"6",md:"3",lg:"3"},{default:n(()=>[s(J,{variant:"outlined",class:"filter-group pa-2",theme:y.value?"dark":"light"},{default:n(()=>[t("div",la,[s(G,{size:"small",color:"primary",class:"mr-1"},{default:n(()=>l[26]||(l[26]=[P("mdi-account-outline")])),_:1,__:[26]}),l[27]||(l[27]=t("span",{class:"text-caption font-weight-medium"},"Gebruiker",-1))]),s(le,{modelValue:$.value,"onUpdate:modelValue":[l[14]||(l[14]=v=>$.value=v),A],items:ie(w).filterUsers,label:"Gebruiker",density:"compact",variant:"outlined","hide-details":"",class:"mb-1",clearable:"","item-title":"Name","item-value":"id",loading:ie(w).isLoading},null,8,["modelValue","items","loading"])]),_:1},8,["theme"])]),_:1})),[[Y,[{action:"manage",resourceType:"user"}]]])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}}),na=Q(sa,[["__scopeId","data-v-16bf6dbd"]]),oa={class:"px-4 pt-4"},ia={class:"tasks-container"},ra={class:"tasks-section"},da={class:"date-groups"},ua={class:"tasks-container"},ca={class:"task-segment completed-segment"},ma=X({__name:"TodoTasksCard",props:{tasks:{type:Array,default:()=>[]},statusCache:{type:Object,required:!0},selectedDate:{type:Date,default:void 0},activeFilters:{type:Object,default:()=>null}},emits:["toggle-task-status","open-melding","open-url","more-menu","task-updated"],setup(u,{expose:O,emit:i}){const y=u,w=i,I=D("open"),U=D(null),m=D(y.activeFilters);function g(a){m.value=a,w("task-updated",m.value)}const T=D(null),k=D(null),r=p(()=>{let a=y.tasks;if(m.value){if(m.value.actionType&&(a=a.filter(o=>o.actionType===m.value.actionType)),m.value.category&&(a=a.filter(o=>o.category===m.value.category)),m.value.finished!==null&&m.value.finished!==void 0&&(a=a.filter(o=>o.finished===m.value.finished)),m.value.itemStatus&&(a=a.filter(o=>{if(o.actionType!=="traject")return!0;const d=`${o.category}-${o.correctiefId||o.preventiefId}`,b=y.statusCache[d];return b?b.id===m.value.itemStatus:!1})),m.value.meldingStatus&&(a=a.filter(o=>{const d=`${o.category}-${o.correctiefId||o.preventiefId}`,b=y.statusCache[d];return b?b.StatusNaam===m.value.meldingStatus:!1})),m.value.startDate){const o=new Date(m.value.startDate);a=a.filter(d=>new Date(d.deadline)>=o)}if(m.value.endDate){const o=new Date(m.value.endDate);o.setHours(23,59,59,999),a=a.filter(d=>new Date(d.deadline)<=o)}if(m.value.status){const o=new Date;m.value.status==="exceeding"?a=a.filter(d=>new Date(d.deadline)<o):m.value.status==="upcoming"&&(a=a.filter(d=>new Date(d.deadline)>=o))}}return a}),M=p(()=>r.value.filter(a=>a.finished)),_=p(()=>r.value.filter(a=>{if(a.finished)return!1;if(a.actionType==="traject"){const o=`${a.category}-${a.correctiefId||a.preventiefId}`,d=y.statusCache[o];if(d&&d.StatusNaam==="Afgerond")return!1}return!0})),C=p(()=>{const a=new Date;return _.value.filter(o=>new Date(o.deadline)<a).sort((o,d)=>new Date(o.deadline).getTime()-new Date(d.deadline).getTime())}),$=p(()=>{const a=new Date;return _.value.filter(o=>new Date(o.deadline)>=a).sort((o,d)=>new Date(o.deadline).getTime()-new Date(d.deadline).getTime())}),H=p(()=>{const a=new Date;return r.value.filter(d=>new Date(d.deadline)>=a).sort((d,b)=>new Date(d.deadline).getTime()-new Date(b.deadline).getTime()).reduce((d,b)=>{const F=new Date(b.deadline).toDateString();return d[F]||(d[F]=[]),d[F].push(b),d},{})}),q=p(()=>M.value.sort((o,d)=>new Date(d.completedAt||d.deadline).getTime()-new Date(o.completedAt||o.deadline).getTime()).reduce((o,d)=>{const b=new Date(d.completedAt||d.deadline).toDateString();return o[b]||(o[b]=[]),o[b].push(d),o},{}));function K(a){return new Date(a).toDateString()===new Date().toDateString()}function z(a){return y.selectedDate&&new Date(a).toDateString()===y.selectedDate.toDateString()}function W(a){return new Date(a).toLocaleDateString("nl-NL",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}function B(a){w("toggle-task-status",a)}function L(a){w("open-melding",a)}function A(a){w("open-url",a)}function h(a){w("more-menu",a)}function e(){C.value.length!==0&&(I.value="open",ce(()=>{var o;const a=document.querySelector(".tasks-scroll-container");if(a&&((o=T.value)!=null&&o.segmentRef)){const d=T.value.segmentRef.offsetTop;a.scrollTo({top:d-16,behavior:"smooth"})}}))}function l(){$.value.length!==0&&(I.value="open",ce(()=>{var o;const a=document.querySelector(".tasks-scroll-container");if(a&&((o=k.value)!=null&&o.segmentRef)){const d=k.value.segmentRef.offsetTop;a.scrollTo({top:d-16,behavior:"smooth"})}}))}O({exceedingTasks:C,upcomingTasks:$,completedTasks:M,scrollToExceedingTasks:e,scrollToUpcomingTasks:l,showCompletedTasks:Y});function Y(){I.value="completed"}function v(a){U.value=a}return(a,o)=>(f(),j(J,{class:"mb-6 tasks-card",elevation:"0"},{default:n(()=>[t("div",oa,[s(na,{onUpdateFilters:g,"initial-filters":m.value,"status-cache":u.statusCache},null,8,["initial-filters","status-cache"])]),s(Je,{modelValue:I.value,"onUpdate:modelValue":o[0]||(o[0]=d=>I.value=d),class:"mt-2"},{default:n(()=>[s(ke,{value:"open"},{default:n(()=>o[2]||(o[2]=[P("Openstaand")])),_:1,__:[2]}),s(ke,{value:"completed"},{default:n(()=>o[3]||(o[3]=[P("Afgerond ")])),_:1,__:[3]})]),_:1},8,["modelValue"]),s(be,{class:"pa-0 tasks-scroll-container"},{default:n(()=>[s(Xe,{modelValue:I.value,"onUpdate:modelValue":o[1]||(o[1]=d=>I.value=d)},{default:n(()=>[s(ye,{value:"open"},{default:n(()=>[t("div",ia,[C.value.length>0?(f(),j(he,{key:0,title:"Overschreden deadlines","segment-class":"exceeding-segment","header-class":"exceeding-header",icon:"mdi-alert-circle","icon-color":"error",tasks:C.value,ref_key:"exceedingSegmentRef",ref:T},{default:n(()=>[t("div",ra,[(f(!0),V(ae,null,te(C.value,d=>(f(),j(de,{key:d.id,task:d,"status-cache":u.statusCache,"show-deadline":!0,"expanded-task-id":U.value,onToggleStatus:B,onOpenMelding:L,onOpenUrl:A,onMoreMenu:h,onExpandTask:v},null,8,["task","status-cache","expanded-task-id"]))),128))])]),_:1},8,["tasks"])):N("",!0),s(he,{title:"Aankomende deadlines","segment-class":"upcoming-segment","header-class":"upcoming-header",icon:"mdi-clock-fast","icon-color":"warning",tasks:$.value,ref_key:"upcomingSegmentRef",ref:k},{default:n(()=>[t("div",da,[(f(!0),V(ae,null,te(H.value,(d,b)=>(f(),j(Te,{key:b,date:b,"is-today":K(b),"is-selected":z(b),"formatted-date":W(b)},{default:n(()=>[(f(!0),V(ae,null,te(d,F=>(f(),j(de,{key:F.id,task:F,"status-cache":u.statusCache,"is-highlighted":z(F.deadline),"expanded-task-id":U.value,onToggleStatus:B,onOpenMelding:L,onOpenUrl:A,onMoreMenu:h,onExpandTask:v},null,8,["task","status-cache","is-highlighted","expanded-task-id"]))),128))]),_:2},1032,["date","is-today","is-selected","formatted-date"]))),128))])]),_:1},8,["tasks"])])]),_:1}),s(ye,{value:"completed"},{default:n(()=>[t("div",ua,[t("div",ca,[(f(!0),V(ae,null,te(q.value,(d,b)=>(f(),j(Te,{key:b,date:b,"is-today":K(b),"is-selected":z(b),"formatted-date":W(b)},{default:n(()=>[(f(!0),V(ae,null,te(d,F=>(f(),j(de,{key:F.id,task:F,"status-cache":u.statusCache,"expanded-task-id":U.value,onToggleStatus:B,onOpenMelding:L,onOpenUrl:A,onMoreMenu:h,onExpandTask:v},null,8,["task","status-cache","expanded-task-id"]))),128))]),_:2},1032,["date","is-today","is-selected","formatted-date"]))),128))])])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}))}}),fa=Q(ma,[["__scopeId","data-v-44f81644"]]),va={key:0,class:"text-subtitle-1 text-medium-emphasis mb-4"},pa={class:"todos-page"},ga={key:0,class:"d-flex justify-center align-center",style:{height:"400px"}},ka=X({__name:"TasksPage",setup(u){const O=D(!1),i=Qe.global.t,y=tt(),w=we(),I=Ye(),U=lt(),m=Se(),g=D(""),T=D(null),k=D({}),r=D(null),M=D({}),_=D(null),C=p(()=>T.value||g.value),$=p(()=>C.value?y.getTasksByUserId(C.value):(console.log("No target user ID found"),[])),H=p(()=>$.value.length),q=p(()=>$.value.filter(c=>c.finished)),K=p(()=>{const c=new Date;return $.value.filter(x=>!x.finished&&new Date(x.deadline)<c).sort((x,E)=>new Date(x.deadline).getTime()-new Date(E.deadline).getTime())}),z=p(()=>{const c=new Date;return $.value.filter(x=>!x.finished&&new Date(x.deadline)>=c).sort((x,E)=>new Date(x.deadline).getTime()-new Date(E.deadline).getTime())}),W=p(()=>[{title:"Overschreden",value:K.value.length,color:"error",action:h,clickable:K.value.length>0},{title:"Aankomend",value:z.value.length,color:"warning",action:e,clickable:z.value.length>0},{title:"Afgerond",value:q.value.length,color:"success",action:o,clickable:q.value.length>0},{title:"Totaal",value:H.value,color:"primary",action:null,clickable:!1}]),B=p(()=>{if(!T.value)return null;const c=T.value,x=m.getUserByIdForPDCA(c);return x?x.Name:null});function L(c){r.value=r.value&&r.value.toDateString()===c.toDateString()?null:c,r.value&&A()}function A(){if(r.value&&_.value){const c=r.value.toDateString(),x=new Date;r.value<x?_.value.scrollToExceedingTasks():ce(()=>{const E=document.querySelector(`.tasks-scroll-container [data-date="${c}"]`);if(E){const R=document.querySelector(".tasks-scroll-container");if(R){const re=E.getBoundingClientRect().top,$e=R.getBoundingClientRect().top,Ue=re-$e+R.scrollTop-16;R.scrollTo({top:Ue,behavior:"smooth"})}}})}}function h(){_.value&&_.value.scrollToExceedingTasks()}function e(){_.value&&_.value.scrollToUpcomingTasks()}async function l(c){try{const x=c.finished,E=y.getTaskById(c.id);E&&(E.finished=c.finished,E.completedAt=c.finished?new Date:null),await y.updateTask(c.id,c.category||"unknown",{completedAt:c.finished?new Date:null,finished:c.finished})}catch(x){console.error("Failed to update task status:",x);const E=y.getTaskById(c.id);E&&(E.finished=!c.finished,E.completedAt=c.finished?null:new Date)}}function Y(c){console.log("Opening melding item:",c.id)}function v(c){c&&window.open(c,"_blank")}function a(c){console.log("Opening more options for task",c.id)}function o(){_.value&&_.value.showCompletedTasks()}function d(c){c.action&&c.action()}async function b(c){console.log("[TasksPage] handleFiltersUpdate received:",c),M.value=c;const x=c.userId||null;console.log("[TasksPage] Current selectedUserIdFilter:",T.value," | Incoming userId:",x),T.value!==x&&(console.log("[TasksPage] User filter changed. Updating selectedUserIdFilter..."),T.value=x,console.log("[TasksPage] Updated selectedUserIdFilter:",T.value),await F())}async function F(){if(!C.value){console.warn("Cannot fetch tasks: No target user ID.");return}O.value=!0;try{await y.fetchTasksByUserId(C.value),await Ce()}catch(c){console.error("Error fetching tasks:",c)}finally{O.value=!1}}_e(async()=>{U.setPageInfo("Taakoverzicht",[{title:i("verbeterplein.breadcrumbs.home"),href:"/"},{title:i("verbeterplein.breadcrumbs.verbeterplein"),href:"/todos"}]),w.initialized||await w.initializeData(),g.value=Ve(),await F()});function Ve(){return!I.user||!I.user.id?(console.warn("User not authenticated or user ID not available"),""):I.user.id}async function Ce(){await Ie($.value)}async function Ie(c){if(!c||c.length===0)return null;try{const x=$.value.map(R=>({id:R.id,category:R.category})),E=await y.findByIds(x);return E.forEach(R=>{const re=`${R.category}-${R.correctiefId||R.preventiefId}`;k.value[re]=R}),E}catch(x){return console.error("Error fetching status for task:",x),null}}return(c,x)=>(f(),j(Ze,{fluid:"",class:"pa-4"},{default:n(()=>[B.value?(f(),V("h5",va,"Taken voor: "+S(B.value),1)):N("",!0),t("div",pa,[s(mt,{class:"hidden-sm-and-down","kpi-items":W.value,onKpiClick:d},null,8,["kpi-items"]),s(me,null,{default:n(()=>[s(Z,{cols:"12",md:"5",lg:"4",class:"order-md-2"},{default:n(()=>[s(rt,{tasks:$.value,onDayClick:L},null,8,["tasks"])]),_:1}),s(Z,{cols:"12",md:"7",lg:"8",class:"order-md-1"},{default:n(()=>[ie(y).loading||O.value?(f(),V("div",ga,[s(et,{indeterminate:"",color:"primary"})])):(f(),j(fa,{key:1,tasks:$.value,"status-cache":k.value,"selected-date":r.value||void 0,"active-filters":M.value,ref_key:"tasksCardRef",ref:_,onToggleTaskStatus:l,onOpenMelding:Y,onOpenUrl:v,onMoreMenu:a,onTaskUpdated:b},null,8,["tasks","status-cache","selected-date","active-filters"]))]),_:1})]),_:1})])]),_:1}))}}),xa=Q(ka,[["__scopeId","data-v-d86027ce"]]);export{xa as default};
