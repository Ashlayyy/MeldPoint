import{bt as c,aY as n,br as p,bw as y,bx as w,bq as m,aZ as R}from"./index-5wn-0GR-.js";const N="/header-bullet.svg";async function f(t=!1){const r="all-reports",e=c.get(r);if(e&&!t)return{status:200,data:e};const s=await n.get("undefined/melding");return c.set(r,s.data.data,{ttl:60*1e3}),{status:s.status,data:s.data.data}}async function F(t,r=!1){if(!t)throw new Error("ID is required");const e=`report-${t}`,s=c.get(e);if(s&&!r)return{status:200,data:s};const a=await n.get(`undefined/melding/${t}`);return c.set(e,a.data.data,{ttl:5*60*1e3}),{status:a.status,data:a.data.data}}async function C(t,r=!1){if(!t)throw new Error("Volgnummer is required");const e=`report-${t}`,s=c.get(e);if(s&&!r)return{status:200,data:s};const a=await n.get(`undefined/melding/volgnummer/${t}`);return c.set(e,a.data.data,{ttl:5*60*1e3}),{status:a.status,data:a.data.data}}async function S(t){if(!t)throw new Error("Data is required");const r=await n.post("undefined/melding",t);return{status:r.status,data:r.data.data}}async function h(t,r){if(!t||!r)throw new Error("ID and data are required");console.log("A2- UpdateReport from Mleding.ts going to happen"),console.log("data",r);const e=await n.patch(`undefined/melding/${t}`,r);return{status:e.status,data:e.data}}async function q(t,r){if(!t||!r)throw new Error("Both meldingID and cloneID are required");const e=await n.post(`undefined/melding/clone/${t}/${r}`);return{status:e.status,data:e.data.data}}async function D(t,r){if(!t||!r)throw new Error("Both meldingID and correspondence are required");const e=await n.patch(`undefined/melding/correspondence/${t}`,{correspondence:r});return{status:e.status,data:e.data.data}}async function $(t,r){if(!t||!r)throw new Error("Both meldingID and correspondenceID are required");const e=await n.delete(`undefined/melding/correspondence/${t}/${r}`);return{status:e.status,data:e.data.data}}async function v(t){if(!t)throw new Error("FileKey is required");const r=await n.delete(`undefined/melding/deleteFile/${t}`);return{status:r.status,data:r.data.data}}async function E(t){if(!t)throw new Error("PreventiefID is required");const r=await n.get(`undefined/melding/preventief/${t}`);return{status:r.status,data:r.data.data}}async function g(){const t=await n.get("undefined/melding/fetch/lengths");return{status:t.status,data:t.data.data}}async function P(t,r){const e={ids:t,archived:r};return{status:(await n.post("undefined/batch/archive",e)).status}}const o=m.global.t,l=R(),d=w();const z=p("melding",{state:()=>({reports:[],selectedFormId:"",selectedForm:null,loading:{single:!1,all:!1},lengths:{all:0,ops:0,correctief:0,pdca:0,archived:0,financed:0},initialized:!1,currentLoadingId:null,reportCache:new Map,pendingRequests:new Map,refreshTimeout:null,refreshInProgress:!1,initializationPromise:null}),getters:{pdcaReports:t=>{var a;const r=(a=t.reports)==null?void 0:a.filter(i=>i.Type==="Melding"&&i.Archived===!1&&i.PDCA===!0);r.sort((i,u)=>Number(i.VolgNummer)-Number(u.VolgNummer));const e=new Set;return r.filter(i=>{var u;return(u=i.Preventief)!=null&&u.id?e.has(i.Preventief.id)?!1:(e.add(i.Preventief.id),!0):!0}).sort((i,u)=>Number(u.VolgNummer)-Number(i.VolgNummer))},getReportById:t=>r=>t.reports.find(e=>e.id===r),getReportByVolgNummer:t=>r=>{if(t.reportCache.has(r))return t.reportCache.get(r);const e=t.reports.find(s=>Number(s.VolgNummer)===Number(r));return e&&t.reportCache.set(r,e),e}},actions:{async initialize(){if(!this.initialized)return this.loading.all=!0,this.initializationPromise?this.initializationPromise:(this.initializationPromise=d.executeRequest("melding","initialization",async()=>{try{const[t,r]=await Promise.all([g(),f(!1)]);r.status===200&&(this.reports=r.data),t.status===200&&(this.lengths=t.data),this.initialized=!0}catch(t){throw t}finally{this.initializationPromise=null,this.loading.all=!1}}),this.initializationPromise)},async initializeData(){return this.initialize()},refreshData:y.debounce(async function(){return this.initialized?d.executeRequest("melding","refresh",async()=>{const[t,r]=await Promise.all([f(!1),g()]);t.status===200&&(this.reports=t.data),r.status===200&&(this.lengths=r.data)}):this.initialize()},1e3),async fetchSingleReport(t){return d.executeRequest("melding",`fetch-report-${t}`,async()=>{this.loading.single=!0;try{const r=this.reportCache.get(t);if(r)return this.selectedForm=r,r;const e=await C(t);if(e.status===200){const s=e.data;return this.selectedForm=s,this.reportCache.set(t,s),this.reports.find(a=>a.VolgNummer===t)||(this.reports=[...this.reports,s]),s}return null}catch(r){return l.error({message:o("errors.fetch_error",{error:r})}),null}finally{this.loading.single=!1}})},async fetchReports(t=!1){return!t&&!this.initialized?this.initialize():d.executeRequest("melding","fetchReports",async()=>{this.loading.all=!0;try{const r=await f(t);return r.status===200&&(this.reports=r.data),r}finally{this.loading.all=!1}})},async fetchReportById(t,r=!1){this.loading.single=!0;try{const e=await F(t,r);if(e.status===200)return e.data;throw new Error(JSON.stringify(e))}catch(e){l.error({message:o("errors.fetch_error",{error:e})})}finally{this.loading.single=!1}},async addReport(t){return d.executeRequest("melding","addReport",async()=>{this.loading.single=!0;try{const r=await S(t);if(r.status===201)return await this.refreshData(),c.clear(),r;throw new Error(JSON.stringify(r))}finally{this.loading.single=!1}})},async updateReport(t,r){return d.executeRequest("melding",`updateReport-${t}`,async()=>{this.loading.single=!0;try{const e=await h(t,r);if(e.status===200)return await this.refreshData(),c.remove(`report-${t}`),this.selectedForm=e.data.data,e;throw new Error(JSON.stringify(e))}finally{this.loading.single=!1}})},async linkStatusMelding(t,r){this.loading.single=!0;try{const e=await h(t,{StatusID:r});if(e.status===200)return this.selectedForm=e.data.data,{status:e.status,data:e.data.data};throw new Error(JSON.stringify(e))}catch(e){l.error({message:o("errors.link_error",{error:e})})}finally{this.loading.single=!1}},async linkActiehouderMelding(t,r){this.loading.single=!0;try{const e=await h(t,{ActiehouderID:r});if(e.status===200)return this.selectedForm=e.data.data,{status:e.status,data:e.data.data};throw new Error(JSON.stringify(e))}catch(e){l.error({message:o("errors.link_error",{error:e})})}finally{this.loading.single=!1}},async linkPreventief(t,r){this.loading.single=!0;try{const e=await h(t,{PreventiefID:r});if(e.status===200)return this.selectedForm=e.data.data,{status:e.status,data:e.data.data};throw new Error(JSON.stringify(e))}catch(e){l.error({message:o("errors.link_error",{error:e})})}finally{this.loading.single=!1}},async linkCorrectief(t,r){this.loading.single=!0;try{const e=await h(t,{CorrectiefID:r});if(e.status===200)return this.selectedForm=e.data.data,{status:e.status,data:e.data.data};throw new Error(JSON.stringify(e))}catch(e){l.error({message:o("errors.link_error",{error:e})})}finally{this.loading.single=!1}},async linkProject(t,r){this.loading.single=!0;try{const e=await h(t,{ProjectID:r});if(e.status===200)return this.selectedForm=e.data.data,{status:e.status,data:e.data.data};throw new Error(JSON.stringify(e))}catch(e){l.error({message:o("errors.link_error",{error:e})})}finally{this.loading.single=!1}},async archiveReport(t,r=!0){return d.executeRequest("melding","archive",async()=>{this.loading.single=!0;try{const e=await P(t,r);if(e.status===200)return this.reports=[],this.selectedForm=null,await this.refreshData(),e;throw new Error(JSON.stringify(e))}finally{this.loading.single=!1}})},async removeCorrespondence(t,r){return d.executeRequest("melding","removeCorrespondence",async()=>{this.loading.single=!0;try{const e=await $(t,r);if(e.status===200)return this.selectedForm=e.data,{status:e.status,data:e.data};throw new Error(JSON.stringify(e))}catch(e){l.error({message:o("errors.save_error",{error:e})})}finally{this.loading.single=!1}})},async addCorrespondence(t,r){return d.executeRequest("melding","addCorrespondence",async()=>{this.loading.single=!0;try{const e=await D(t,r);if(e.status===200)return this.selectedForm=e.data,{status:e.status,data:e.data};throw new Error(JSON.stringify(e))}catch(e){l.error({message:o("errors.save_error",{error:e})})}finally{this.loading.single=!1}})},async addMeldingToPDCA(t){return d.executeRequest("melding","addMeldingToPDCA",async()=>{this.loading.single=!0;try{const r=await E(t);if(r.status===200)return this.selectedForm=r.data,{status:r.status,data:r.data};throw new Error(JSON.stringify(r))}catch(r){l.error({message:o("errors.save_error",{error:r})})}finally{this.loading.single=!1}})},async addCloneID(t,r){return d.executeRequest("melding","addCloneID",async()=>{this.loading.single=!0;try{const e=await q(t,r);if(e.status===200)return this.selectedForm=e.data.data,{status:e.status,data:e.data.data};throw new Error(JSON.stringify(e))}catch(e){l.error({message:o("errors.save_error",{error:e})})}finally{this.loading.single=!1}})},async updateCurrentForm(t=!1){this.selectedForm=await this.fetchReportById(this.selectedFormId,t)},setSelectedFormId(t){this.selectedFormId=t},setSelectedForm(t){this.selectedForm=t,t!=null&&t.VolgNummer&&this.reportCache.set(t.VolgNummer,t)},clearCache(){this.reportCache.clear()}}});export{v as D,f as G,h as U,N as _,z as u};
